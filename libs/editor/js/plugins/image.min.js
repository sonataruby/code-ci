!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(we){"use strict";function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}we=we&&we.hasOwnProperty("default")?we.default:we,Object.assign(we.POPUP_TEMPLATES,{"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"}),Object.assign(we.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:["imageReplace","imageAlign","imageCaption","imageRemove","imageLink","linkOpen","linkEdit","linkRemove","-","imageDisplay","imageStyle","imageAlt","imageSize"],imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack","|"],imageUpload:!0,imageUploadURL:null,imageCORSProxy:"https://cors-anywhere.froala.com",imageUploadRemoteUrls:!0,imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif","webp"],imageResize:!0,imageResizeWithPercent:!1,imageRoundPercent:!1,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageSplitHTML:!1,imageStyles:{"fr-rounded":"Rounded","fr-bordered":"Bordered","fr-shadow":"Shadow"},imageMove:!0,imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0,imagePasteProcess:!1,imageMinWidth:16,imageOutputSize:!1,imageDefaultMargin:5,imageAddNewLine:!1}),we.PLUGINS.image=function(u){var h,o,l,f,p,a,v=u.$,b="https://i.froala.com/upload",t=!1,i=1,y=2,w=3,C=4,A=5,E=6,r={};function g(){var e=u.popups.get("image.insert").find(".fr-image-by-url-layer input");e.val(""),h&&e.val(h.attr("src")),e.trigger("change")}function n(){var e=u.popups.get("image.edit");if(e=e||I()){var t=be();ye()&&(t=t.find(".fr-img-wrap")),u.popups.setContainer("image.edit",u.$sc),u.popups.refresh("image.edit");var a=t.offset().left+t.outerWidth()/2,i=t.offset().top+t.outerHeight();h.hasClass("fr-uploading")?P():u.popups.show("image.edit",a,i,t.outerHeight(),!0)}}function d(){O()}function s(e){0<e.parents(".fr-img-caption").length&&(e=e.parents(".fr-img-caption").first());var t=e.hasClass("fr-dib")?"block":e.hasClass("fr-dii")?"inline":null,a=e.hasClass("fr-fil")?"left":e.hasClass("fr-fir")?"right":ce(e);de(e,t,a),e.removeClass("fr-dib fr-dii fr-fir fr-fil")}function e(){for(var e,t="IMG"==u.el.tagName?[u.el]:u.el.querySelectorAll("img"),a=0;a<t.length;a++){var i=v(t[a]);!u.opts.htmlUntouched&&u.opts.useClasses?((u.opts.imageDefaultAlign||u.opts.imageDefaultDisplay)&&(0<(e=i).parents(".fr-img-caption").length&&(e=e.parents(".fr-img-caption").first()),e.hasClass("fr-dii")||e.hasClass("fr-dib")||(e.addClass("fr-fi"+ce(e)[0]),e.addClass("fr-di"+me(e)[0]),e.css("margin",""),e.css("float",""),e.css("display",""),e.css("z-index",""),e.css("position",""),e.css("overflow",""),e.css("vertical-align",""))),u.opts.imageTextNear||(0<i.parents(".fr-img-caption").length?i.parents(".fr-img-caption").first().removeClass("fr-dii").addClass("fr-dib"):i.removeClass("fr-dii").addClass("fr-dib"))):u.opts.htmlUntouched||u.opts.useClasses||(u.opts.imageDefaultAlign||u.opts.imageDefaultDisplay)&&s(i),u.opts.iframe&&i.on("load",u.size.syncIframe)}}function c(e){void 0===e&&(e=!0);var t,a=Array.prototype.slice.call(u.el.querySelectorAll("img")),i=[];for(t=0;t<a.length;t++)if(i.push(a[t].getAttribute("src")),v(a[t]).toggleClass("fr-draggable",u.opts.imageMove),""===a[t].getAttribute("class")&&a[t].removeAttribute("class"),""===a[t].getAttribute("style")&&a[t].removeAttribute("style"),a[t].parentNode&&a[t].parentNode.parentNode&&u.node.hasClass(a[t].parentNode.parentNode,"fr-img-caption")){var r=a[t].parentNode.parentNode;u.browser.mozilla||r.setAttribute("contenteditable",!1),r.setAttribute("draggable",!1),r.classList.add("fr-draggable");var n=a[t].nextSibling;n&&!u.browser.mozilla&&n.setAttribute("contenteditable",!0)}if(p)for(t=0;t<p.length;t++)i.indexOf(p[t].getAttribute("src"))<0&&u.events.trigger("image.removed",[v(p[t])]);if(p&&e){var s=[];for(t=0;t<p.length;t++)s.push(p[t].getAttribute("src"));for(t=0;t<a.length;t++)s.indexOf(a[t].getAttribute("src"))<0&&u.events.trigger("image.loaded",[v(a[t])])}p=a}function S(){if(o||function(){var e;if(u.shared.$image_resizer?(o=u.shared.$image_resizer,f=u.shared.$img_overlay,u.events.on("destroy",function(){v("body").first().append(o.removeClass("fr-active"))},!0)):(u.shared.$image_resizer=v(document.createElement("div")).attr("class","fr-image-resizer"),o=u.shared.$image_resizer,u.events.$on(o,"mousedown",function(e){e.stopPropagation()},!0),u.opts.imageResize&&(o.append(m("nw")+m("ne")+m("sw")+m("se")),u.shared.$img_overlay=v(document.createElement("div")).attr("class","fr-image-overlay"),f=u.shared.$img_overlay,e=o.get(0).ownerDocument,v(e).find("body").first().append(f))),u.events.on("shared.destroy",function(){o.html("").removeData().remove(),o=null,u.opts.imageResize&&(f.remove(),f=null)},!0),u.helpers.isMobile()||u.events.$on(v(u.o_win),"resize",function(){h&&!h.hasClass("fr-uploading")?le(!0):h&&(S(),ue(),P(!1))}),u.opts.imageResize){e=o.get(0).ownerDocument,u.events.$on(o,u._mousedown,".fr-handler",D),u.events.$on(v(e),u._mousemove,x),u.events.$on(v(e.defaultView||e.parentWindow),u._mouseup,$),u.events.$on(f,"mouseleave",$);var i=1,r=null,n=0;u.events.on("keydown",function(e){if(h){var t=-1!=navigator.userAgent.indexOf("Mac OS X")?e.metaKey:e.ctrlKey,a=e.which;(a!==r||200<e.timeStamp-n)&&(i=1),(a==we.KEYCODE.EQUALS||u.browser.mozilla&&a==we.KEYCODE.FF_EQUALS)&&t&&!e.altKey?i=J.call(this,e,1,1,i):(a==we.KEYCODE.HYPHEN||u.browser.mozilla&&a==we.KEYCODE.FF_HYPHEN)&&t&&!e.altKey?i=J.call(this,e,2,-1,i):u.keys.ctrlKey(e)||a!=we.KEYCODE.ENTER||(h.before("<br>"),B(h)),r=a,n=e.timeStamp}},!0),u.events.on("keyup",function(){i=1})}}(),!h)return!1;var e=u.$wp||u.$sc;e.append(o),o.data("instance",u);var t=e.scrollTop()-("static"!=e.css("position")?e.offset().top:0),a=e.scrollLeft()-("static"!=e.css("position")?e.offset().left:0);a-=u.helpers.getPX(e.css("border-left-width")),t-=u.helpers.getPX(e.css("border-top-width")),u.$el.is("img")&&u.$sc.is("body")&&(a=t=0);var i=be();ye()&&(i=i.find(".fr-img-wrap"));var r=0,n=0;u.opts.iframe&&(r=u.helpers.getPX(u.$wp.find(".fr-iframe").css("padding-top")),n=u.helpers.getPX(u.$wp.find(".fr-iframe").css("padding-left"))),o.css("top",(u.opts.iframe?i.offset().top+r:i.offset().top+t)-1).css("left",(u.opts.iframe?i.offset().left+n:i.offset().left+a)-1).css("width",i.get(0).getBoundingClientRect().width).css("height",i.get(0).getBoundingClientRect().height).addClass("fr-active")}function m(e){return'<div class="fr-handler fr-h'+e+'"></div>'}function R(e){ye()?h.parents(".fr-img-caption").css("width",e):h.css("width",e)}function D(e){if(!u.core.sameInstance(o))return!0;if(e.preventDefault(),e.stopPropagation(),u.$el.find("img.fr-error").left)return!1;u.undo.canDo()||u.undo.saveStep();var t=e.pageX||e.originalEvent.touches[0].pageX;if("mousedown"==e.type){var a=u.$oel.get(0).ownerDocument,i=a.defaultView||a.parentWindow,r=!1;try{r=i.location!=i.parent.location&&!(i.$&&i.$.FE)}catch(e){}r&&i.frameElement&&(t+=u.helpers.getPX(v(i.frameElement).offset().left)+i.frameElement.clientLeft)}(l=v(this)).data("start-x",t),l.data("start-width",h.width()),l.data("start-height",h.height());var n=h.width();if(u.opts.imageResizeWithPercent){var s=h.parentsUntil(u.$el,u.html.blockTagsQuery()).get(0)||u.el;n=(n/v(s).outerWidth()*100).toFixed(2)+"%"}R(n),f.show(),u.popups.hideAll(),ge()}function x(e){if(!u.core.sameInstance(o))return!0;var t;if(l&&h){if(e.preventDefault(),u.$el.find("img.fr-error").left)return!1;var a=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null);if(!a)return!1;var i=a-l.data("start-x"),r=l.data("start-width");if((l.hasClass("fr-hnw")||l.hasClass("fr-hsw"))&&(i=0-i),u.opts.imageResizeWithPercent){var n=h.parentsUntil(u.$el,u.html.blockTagsQuery()).get(0)||u.el;r=((r+i)/v(n).outerWidth()*100).toFixed(2),u.opts.imageRoundPercent&&(r=Math.round(r)),R(r+"%"),(t=ye()?(u.helpers.getPX(h.parents(".fr-img-caption").css("width"))/v(n).outerWidth()*100).toFixed(2):(u.helpers.getPX(h.css("width"))/v(n).outerWidth()*100).toFixed(2))===r||u.opts.imageRoundPercent||R(t+"%"),h.css("height","").removeAttr("height")}else r+i>=u.opts.imageMinWidth&&(R(r+i),t=ye()?u.helpers.getPX(h.parents(".fr-img-caption").css("width")):u.helpers.getPX(h.css("width"))),t!==r+i&&R(t),((h.attr("style")||"").match(/(^height:)|(; *height:)/)||h.attr("height"))&&(h.css("height",l.data("start-height")*h.width()/l.data("start-width")),h.removeAttr("height"));S(),u.events.trigger("image.resize",[ve()])}}function $(e){if(!u.core.sameInstance(o))return!0;if(l&&h){if(e&&e.stopPropagation(),u.$el.find("img.fr-error").left)return!1;l=null,f.hide(),S(),n(),u.undo.saveStep(),u.events.trigger("image.resizeEnd",[ve()])}}function U(e,t,a){u.edit.on(),h&&h.addClass("fr-error"),r[e]?N(r[e]):N(u.language.translate("Something went wrong. Please try again.")),!h&&a&&Z(a),u.events.trigger("image.error",[{code:e,message:r[e]},t,a])}function I(e){if(e)return u.$wp&&u.events.$on(u.$wp,"scroll.image-edit",function(){h&&u.popups.isVisible("image.edit")&&(u.events.disableBlur(),n())}),!0;var t="";if(0<u.opts.imageEditButtons.length){var a={buttons:t+='<div class="fr-buttons"> \n        '.concat(u.button.buildList(u.opts.imageEditButtons),"\n        </div>")};return u.popups.create("image.edit",a)}return!1}function P(e){var t=u.popups.get("image.insert");if((t=t||V()).find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),t.find(".fr-image-progress-bar-layer").addClass("fr-active"),t.find(".fr-buttons").hide(),h){var a=be();u.popups.setContainer("image.insert",u.$sc);var i=a.offset().left,r=a.offset().top+a.height();u.popups.show("image.insert",i,r,a.outerHeight())}void 0===e&&k(u.language.translate("Uploading"),0)}function O(e){var t=u.popups.get("image.insert");if(t&&(t.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),t.find(".fr-image-progress-bar-layer").removeClass("fr-active"),t.find(".fr-buttons").show(),e||u.$el.find("img.fr-error").length)){if(u.events.focus(),u.$el.find("img.fr-error").length&&(u.$el.find("img.fr-error").remove(),u.undo.saveStep(),u.undo.run(),u.undo.dropRedo()),!u.$wp&&h){var a=h;le(!0),u.selection.setAfter(a.get(0)),u.selection.restore()}u.popups.hide("image.insert")}}function k(e,t){var a=u.popups.get("image.insert");if(a){var i=a.find(".fr-image-progress-bar-layer");i.find("h3").text(e+(t?" "+t+"%":"")),i.removeClass("fr-error"),t?(i.find("div").removeClass("fr-indeterminate"),i.find("div > span").css("width",t+"%")):i.find("div").addClass("fr-indeterminate")}}function N(e){P();var t=u.popups.get("image.insert").find(".fr-image-progress-bar-layer");t.addClass("fr-error");var a=t.find("h3");a.text(e),u.events.disableBlur(),a.focus()}function B(e){oe.call(e.get(0))}function T(){var e=v(this);u.popups.hide("image.insert"),e.removeClass("fr-uploading"),e.next().is("br")&&e.next().remove(),B(e),u.events.trigger("image.loaded",[e])}function _(s,e,o,l,f){u.edit.off(),k(u.language.translate("Loading image")),e&&(s=u.helpers.sanitizeURL(s));var t=new Image;t.onload=function(){var e,t;if(l){u.undo.canDo()||l.hasClass("fr-uploading")||u.undo.saveStep();var a=l.data("fr-old-src");l.data("fr-image-pasted")&&(a=null),u.$wp?((e=l.clone().removeData("fr-old-src").removeClass("fr-uploading").removeAttr("data-fr-image-pasted")).off("load"),a&&l.attr("src",a),l.replaceWith(e)):e=l;for(var i=e.get(0).attributes,r=0;r<i.length;r++){var n=i[r];0===n.nodeName.indexOf("data-")&&e.removeAttr(n.nodeName)}if(void 0!==o)for(t in o)o.hasOwnProperty(t)&&"link"!=t&&e.attr("data-"+t,o[t]);e.on("load",T),e.attr("src",s),u.edit.on(),c(!1),u.undo.saveStep(),u.events.disableBlur(),u.$el.blur(),u.events.trigger(a?"image.replaced":"image.inserted",[e,f])}else e=z(s,o,T),c(!1),u.undo.saveStep(),u.events.disableBlur(),u.$el.blur(),u.events.trigger("image.inserted",[e,f])},t.onerror=function(){U(i)},P(u.language.translate("Loading image")),t.src=s}function L(){U(C,this.response||this.responseText||this.responseXML)}function M(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;k(u.language.translate("Uploading"),t)}}function z(e,t,a){var i,r=v(document.createElement("img")).attr("src",e);if(t&&void 0!==t)for(i in t)t.hasOwnProperty(i)&&"link"!=i&&(t[i],r.attr("data-str"+i,t[i]));var n=u.opts.imageDefaultWidth;n&&"auto"!=n&&(n=u.opts.imageResizeWithPercent?"100%":n+"px"),r.attr("style",n?"width: "+n+";":""),de(r,u.opts.imageDefaultDisplay,u.opts.imageDefaultAlign),r.on("load",a),r.on("error",a),u.edit.on(),u.events.focus(!0),u.selection.restore(),u.undo.saveStep(),u.opts.imageSplitHTML?u.markers.split():u.markers.insert(),u.html.wrap();var s=u.$el.find(".fr-marker");return s.length?(s.parent().is("hr")&&s.parent().after(s),u.node.isLastSibling(s)&&s.parent().hasClass("fr-deletable")&&s.insertAfter(s.parent()),s.replaceWith(r)):u.$el.append(r),u.selection.clear(),r}function K(){u.edit.on(),O(!0)}function Y(e,t){if(void 0!==e&&0<e.length){if(!1===u.events.trigger("image.beforeUpload",[e,t]))return!1;var a,i=e[0];if((null===u.opts.imageUploadURL||u.opts.imageUploadURL==b)&&!u.opts.imageUploadToS3)return d=i,c=t||h,(m=new FileReader).onload=function(){var e=m.result;if(m.result.indexOf("svg+xml")<0){for(var t=atob(m.result.split(",")[1]),a=[],i=0;i<t.length;i++)a.push(t.charCodeAt(i));e=window.URL.createObjectURL(new Blob([new Uint8Array(a)],{type:d.type})),u.image.insert(e,!1,null,c)}},P(),m.readAsDataURL(d),!1;if(i.name||(i.name=(new Date).getTime()+"."+(i.type||"image/jpeg").replace(/image\//g,"")),i.size>u.opts.imageMaxSize)return U(A),!1;if(u.opts.imageAllowedTypes.indexOf(i.type.replace(/image\//g,""))<0)return U(E),!1;if(u.drag_support.formdata&&(a=u.drag_support.formdata?new FormData:null),a){var r;if(!1!==u.opts.imageUploadToS3)for(r in a.append("key",u.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(i.name||"untitled")),a.append("success_action_status","201"),a.append("X-Requested-With","xhr"),a.append("Content-Type",i.type),u.opts.imageUploadToS3.params)u.opts.imageUploadToS3.params.hasOwnProperty(r)&&a.append(r,u.opts.imageUploadToS3.params[r]);for(r in u.opts.imageUploadParams)u.opts.imageUploadParams.hasOwnProperty(r)&&a.append(r,u.opts.imageUploadParams[r]);a.append(u.opts.imageUploadParam,i,i.name);var n=u.opts.imageUploadURL;u.opts.imageUploadToS3&&(n=u.opts.imageUploadToS3.uploadURL?u.opts.imageUploadToS3.uploadURL:"https://"+u.opts.imageUploadToS3.region+".amazonaws.com/"+u.opts.imageUploadToS3.bucket),o=u.core.getXHR(n,u.opts.imageUploadMethod),l=a,f=i,p=t||h,(g=new FileReader).onload=function(){var e=g.result;if(g.result.indexOf("svg+xml")<0){for(var t=atob(g.result.split(",")[1]),a=[],i=0;i<t.length;i++)a.push(t.charCodeAt(i));e=window.URL.createObjectURL(new Blob([new Uint8Array(a)],{type:"image/jpeg"}))}p?(p.on("load",s),p.on("error",function(){s(),v(this).off("error")}),u.edit.on(),u.undo.saveStep(),p.data("fr-old-src",p.attr("src")),p.attr("src",e)):z(e,null,s)},g.readAsDataURL(f)}}function s(){var e=v(this);e.off("load"),e.addClass("fr-uploading"),e.next().is("br")&&e.next().remove(),u.placeholder.refresh(),B(e),S(),P(),u.edit.off(),o.onload=function(){(function(t){k(u.language.translate("Loading image"));var e=this.status,a=this.response,i=this.responseXML,r=this.responseText;try{if(u.opts.imageUploadToS3)if(201==e){var n=function(t){try{var e=v(t).find("Location").text(),a=v(t).find("Key").text();return!1===u.events.trigger("image.uploadedToS3",[e,a,t],!0)?(u.edit.on(),!1):e}catch(e){return U(C,t),!1}}(i);n&&_(n,!1,[],t,a||i)}else U(C,a||i,t);else if(200<=e&&e<300){var s=function(t){try{if(!1===u.events.trigger("image.uploaded",[t],!0))return u.edit.on(),!1;var e=JSON.parse(t);return e.link?e:(U(y,t),!1)}catch(e){return U(C,t),!1}}(r);s&&_(s.link,!1,s,t,a||r)}else U(w,a||r,t)}catch(e){U(C,a||r,t)}}).call(o,e)},o.onerror=L,o.upload.onprogress=M,o.onabort=K,v(e.off("abortUpload")).on("abortUpload",function(){4!=o.readyState&&(o.abort(),p?(p.attr("src",p.data("fr-old-src")),p.removeClass("fr-uploading")):e.remove(),le(!0))}),o.send(l)}var o,l,f,p,g,d,c,m}function W(e){if(e.is("img")&&0<e.parents(".fr-img-caption").length)return e.parents(".fr-img-caption")}function G(e){var t=e.originalEvent.dataTransfer;if(t&&t.files&&t.files.length){var a=t.files[0];if(a&&a.type&&-1!==a.type.indexOf("image")&&0<=u.opts.imageAllowedTypes.indexOf(a.type.replace(/image\//g,""))){if(!u.opts.imageUpload)return e.preventDefault(),e.stopPropagation(),!1;u.markers.remove(),u.markers.insertAtPoint(e.originalEvent),u.$el.find(".fr-marker").replaceWith(we.MARKERS),0===u.$el.find(".fr-marker").length&&u.selection.setAtEnd(u.el),u.popups.hideAll();var i=u.popups.get("image.insert");i=i||V(),u.popups.setContainer("image.insert",u.$sc);var r=e.originalEvent.pageX,n=e.originalEvent.pageY;if(u.opts.iframe){var s=u.helpers.getPX(u.$wp.find(".fr-iframe").css("padding-top")),o=u.helpers.getPX(u.$wp.find(".fr-iframe").css("padding-left"));n+=u.$iframe.offset().top+s,r+=u.$iframe.offset().left+o}return u.popups.show("image.insert",r,n),P(),0<=u.opts.imageAllowedTypes.indexOf(a.type.replace(/image\//g,""))?(le(!0),Y(t.files)):U(E),e.preventDefault(),e.stopPropagation(),!1}}}function V(e){if(e)return u.popups.onRefresh("image.insert",g),u.popups.onHide("image.insert",d),!0;var t,a,i="";u.opts.imageUpload||-1===u.opts.imageInsertButtons.indexOf("imageUpload")||u.opts.imageInsertButtons.splice(u.opts.imageInsertButtons.indexOf("imageUpload"),1);var r=u.button.buildList(u.opts.imageInsertButtons);""!==r&&(i='<div class="fr-buttons fr-tabs">'+r+"</div>");var n=u.opts.imageInsertButtons.indexOf("imageUpload"),s=u.opts.imageInsertButtons.indexOf("imageByURL"),o="";0<=n&&(t=" fr-active",0<=s&&s<n&&(t=""),o='<div class="fr-image-upload-layer'+t+' fr-layer" id="fr-image-upload-layer-'+u.id+'"><strong>'+u.language.translate("Drop image")+"</strong><br>("+u.language.translate("or click")+')<div class="fr-form"><input type="file" accept="image/'+u.opts.imageAllowedTypes.join(", image/").toLowerCase()+'" tabIndex="-1" aria-labelledby="fr-image-upload-layer-'+u.id+'" role="button"></div></div>');var l="";0<=s&&(t=" fr-active",0<=n&&n<s&&(t=""),l='<div class="fr-image-by-url-layer'+t+' fr-layer" id="fr-image-by-url-layer-'+u.id+'"><div class="fr-input-line"><input id="fr-image-by-url-layer-text-'+u.id+'" type="text" placeholder="http://" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2" role="button">'+u.language.translate("Insert")+"</button></div></div>");var f,p={buttons:i,upload_layer:o,by_url_layer:l,progress_bar:'<div class="fr-image-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="imageDismissError" tabIndex="2" role="button">OK</button></div></div>'};return 1<=u.opts.imageInsertButtons.length&&(a=u.popups.create("image.insert",p)),u.$wp&&u.events.$on(u.$wp,"scroll",function(){h&&u.popups.isVisible("image.insert")&&ue()}),f=a,u.events.$on(f,"dragover dragenter",".fr-image-upload-layer",function(){return v(this).addClass("fr-drop"),!1},!0),u.events.$on(f,"dragleave dragend",".fr-image-upload-layer",function(){return v(this).removeClass("fr-drop"),!1},!0),u.events.$on(f,"drop",".fr-image-upload-layer",function(e){e.preventDefault(),e.stopPropagation(),v(this).removeClass("fr-drop");var t=e.originalEvent.dataTransfer;if(t&&t.files){var a=f.data("instance")||u;a.events.disableBlur(),a.image.upload(t.files),a.events.enableBlur()}},!0),u.helpers.isIOS()&&u.events.$on(f,"touchstart",'.fr-image-upload-layer input[type="file"]',function(){v(this).trigger("click")},!0),u.events.$on(f,"change",'.fr-image-upload-layer input[type="file"]',function(){if(this.files){var e=f.data("instance")||u;e.events.disableBlur(),f.find("input:focus").blur(),e.events.enableBlur(),e.image.upload(this.files,h)}v(this).val("")},!0),a}function H(){h&&u.popups.get("image.alt").find("input").val(h.attr("alt")||"").trigger("change")}function X(){var e=u.popups.get("image.alt");e=e||F(),O(),u.popups.refresh("image.alt"),u.popups.setContainer("image.alt",u.$sc);var t=be();ye()&&(t=t.find(".fr-img-wrap"));var a=t.offset().left+t.outerWidth()/2,i=t.offset().top+t.outerHeight();u.popups.show("image.alt",a,i,t.outerHeight(),!0)}function F(e){if(e)return u.popups.onRefresh("image.alt",H),!0;var t={buttons:'<div class="fr-buttons fr-tabs">'+u.button.buildList(u.opts.imageAltButtons)+"</div>",alt_layer:'<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'+u.id+'"><div class="fr-input-line"><input id="fr-image-alt-layer-text-'+u.id+'" type="text" placeholder="'+u.language.translate("Alternative Text")+'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2" role="button">'+u.language.translate("Update")+"</button></div></div>"},a=u.popups.create("image.alt",t);return u.$wp&&u.events.$on(u.$wp,"scroll.image-alt",function(){h&&u.popups.isVisible("image.alt")&&X()}),a}function j(){var e=u.popups.get("image.size");if(h)if(ye()){var t=h.parent();t.get(0).style.width||(t=h.parent().parent()),e.find('input[name="width"]').val(t.get(0).style.width).trigger("change"),e.find('input[name="height"]').val(t.get(0).style.height).trigger("change")}else e.find('input[name="width"]').val(h.get(0).style.width).trigger("change"),e.find('input[name="height"]').val(h.get(0).style.height).trigger("change")}function q(){var e=u.popups.get("image.size");e=e||Q(),O(),u.popups.refresh("image.size"),u.popups.setContainer("image.size",u.$sc);var t=be();ye()&&(t=t.find(".fr-img-wrap"));var a=t.offset().left+t.outerWidth()/2,i=t.offset().top+t.outerHeight();u.popups.show("image.size",a,i,t.outerHeight(),!0)}function Q(e){if(e)return u.popups.onRefresh("image.size",j),!0;var t={buttons:'<div class="fr-buttons fr-tabs">'+u.button.buildList(u.opts.imageSizeButtons)+"</div>",size_layer:'<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'+u.id+'"><div class="fr-image-group"><div class="fr-input-line"><input id="fr-image-size-layer-width-'+u.id+'" type="text" name="width" placeholder="'+u.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-image-size-layer-height'+u.id+'" type="text" name="height" placeholder="'+u.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2" role="button">'+u.language.translate("Update")+"</button></div></div>"},a=u.popups.create("image.size",t);return u.$wp&&u.events.$on(u.$wp,"scroll.image-size",function(){h&&u.popups.isVisible("image.size")&&q()}),a}function J(e,t,a,i){return e.pageX=t,D.call(this,e),e.pageX=e.pageX+a*Math.floor(Math.pow(1.1,i)),x.call(this,e),$.call(this,e),++i}function Z(e){(e=e||be())&&!1!==u.events.trigger("image.beforeRemove",[e])&&(u.popups.hideAll(),he(),le(!0),u.undo.canDo()||u.undo.saveStep(),e.get(0)==u.el?e.removeAttr("src"):(e.get(0).parentNode&&"A"==e.get(0).parentNode.tagName?(u.selection.setBefore(e.get(0).parentNode)||u.selection.setAfter(e.get(0).parentNode)||e.parent().after(we.MARKERS),v(e.get(0).parentNode).remove()):(u.selection.setBefore(e.get(0))||u.selection.setAfter(e.get(0))||e.after(we.MARKERS),e.remove()),u.html.fillEmptyBlocks(),u.selection.restore()),u.undo.saveStep())}function ee(e){var t=e.which;if(h&&(t==we.KEYCODE.BACKSPACE||t==we.KEYCODE.DELETE))return e.preventDefault(),e.stopPropagation(),Z(),!1;if(h&&t==we.KEYCODE.ESC){var a=h;return le(!0),u.selection.setAfter(a.get(0)),u.selection.restore(),e.preventDefault(),!1}if(!h||t!=we.KEYCODE.ARROW_LEFT&&t!=we.KEYCODE.ARROW_RIGHT)return h&&t===we.KEYCODE.TAB?(e.preventDefault(),e.stopPropagation(),le(!0),!1):h&&t!=we.KEYCODE.F10&&!u.keys.isBrowserAction(e)?(e.preventDefault(),e.stopPropagation(),!1):void 0;var i=h.get(0);return le(!0),t==we.KEYCODE.ARROW_LEFT?u.selection.setBefore(i):u.selection.setAfter(i),u.selection.restore(),e.preventDefault(),!1}function te(e){if(e&&"IMG"==e.tagName){if(u.node.hasClass(e,"fr-uploading")||u.node.hasClass(e,"fr-error")?e.parentNode.removeChild(e):u.node.hasClass(e,"fr-draggable")&&e.classList.remove("fr-draggable"),e.parentNode&&e.parentNode.parentNode&&u.node.hasClass(e.parentNode.parentNode,"fr-img-caption")){var t=e.parentNode.parentNode;t.removeAttribute("contenteditable"),t.removeAttribute("draggable"),t.classList.remove("fr-draggable");var a=e.nextSibling;a&&a.removeAttribute("contenteditable")}}else if(e&&e.nodeType==Node.ELEMENT_NODE)for(var i=e.querySelectorAll("img.fr-uploading, img.fr-error, img.fr-draggable"),r=0;r<i.length;r++)te(i[r])}function ae(e){if(!1===u.events.trigger("image.beforePasteUpload",[e]))return!1;h=v(e),S(),n(),ue(),P(),h.on("load",function(){S(),v(u.popups.get("image.insert").get(0)).find("div.fr-active.fr-error").length<1&&P(),v(this).off("load")});for(var t=v(e).attr("src").split(","),a=atob(t[1]),i=[],r=0;r<a.length;r++)i.push(a.charCodeAt(r));Y([new Blob([new Uint8Array(i)],{type:t[0].replace(/data\:/g,"").replace(/;base64/g,"")})],h)}function ie(){u.opts.imagePaste?u.$el.find("img[data-fr-image-pasted]").each(function(e,i){if(u.opts.imagePasteProcess){var t=u.opts.imageDefaultWidth;t&&"auto"!=t&&(t+=u.opts.imageResizeWithPercent?"%":"px"),v(i).css("width",t).removeClass("fr-dii fr-dib fr-fir fr-fil"),de(v(i),u.opts.imageDefaultDisplay,u.opts.imageDefaultAlign)}if(0===i.src.indexOf("data:"))ae(i);else if(0===i.src.indexOf("blob:")||0===i.src.indexOf("http")&&u.opts.imageUploadRemoteUrls&&u.opts.imageCORSProxy){var a=new Image;a.crossOrigin="Anonymous",a.onload=function(){var e,t=u.o_doc.createElement("CANVAS"),a=t.getContext("2d");t.height=this.naturalHeight,t.width=this.naturalWidth,a.drawImage(this,0,0),setTimeout(function(){ae(i)},0),e=2e3<this.naturalWidth||1500<this.naturalHeight?"jpeg":"png",i.src=t.toDataURL("image/"+e)},a.src=(0===i.src.indexOf("blob:")?"":u.opts.imageCORSProxy+"/")+i.src}else 0!==i.src.indexOf("http")||0===i.src.indexOf("https://mail.google.com/mail")?(u.selection.save(),v(i).remove(),u.selection.restore()):v(i).removeAttr("data-fr-image-pasted")}):u.$el.find("img[data-fr-image-pasted]").remove()}function re(e){var t=e.target.result,a=u.opts.imageDefaultWidth;a&&"auto"!=a&&(a+=u.opts.imageResizeWithPercent?"%":"px"),u.undo.saveStep(),u.html.insert('<img data-fr-image-pasted="true" src="'+t+'"'+(a?' style="width: '+a+';"':"")+">");var i=u.$el.find('img[data-fr-image-pasted="true"]');i&&de(i,u.opts.imageDefaultDisplay,u.opts.imageDefaultAlign),u.events.trigger("paste.after")}function ne(e){if(e&&e.clipboardData&&e.clipboardData.items){var t=null;if(e.clipboardData.types&&-1!=[].indexOf.call(e.clipboardData.types,"text/rtf")||e.clipboardData.getData("text/rtf"))t=e.clipboardData.items[0].getAsFile();else for(var a=0;a<e.clipboardData.items.length&&!(t=e.clipboardData.items[a].getAsFile());a++);if(t)return i=t,(r=new FileReader).onload=re,r.readAsDataURL(i),!1}var i,r}function se(e){return e.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function oe(e){if("false"==v(this).parents("[contenteditable]").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;if(e&&"touchend"==e.type&&a)return!0;if(e&&u.edit.isDisabled())return e.stopPropagation(),e.preventDefault(),!1;for(var t=0;t<we.INSTANCES.length;t++)we.INSTANCES[t]!=u&&we.INSTANCES[t].events.trigger("image.hideResizer");u.toolbar.disable(),e&&(e.stopPropagation(),e.preventDefault()),u.helpers.isMobile()&&(u.events.disableBlur(),u.$el.blur(),u.events.enableBlur()),u.opts.iframe&&u.size.syncIframe(),h=v(this),he(),S(),n(),u.browser.msie?(u.popups.areVisible()&&u.events.disableBlur(),u.win.getSelection&&(u.win.getSelection().removeAllRanges(),u.win.getSelection().addRange(u.doc.createRange()))):u.selection.clear(),u.helpers.isIOS()&&(u.events.disableBlur(),u.$el.blur()),u.button.bulkRefresh(),u.events.trigger("video.hideResizer")}function le(e){h&&(fe||!0===e)&&(u.toolbar.enable(),o.removeClass("fr-active"),u.popups.hide("image.edit"),h=null,ge(),l=null,f&&f.hide())}r[i]="Image cannot be loaded from the passed link.",r[y]="No link in upload response.",r[w]="Error during file upload.",r[C]="Parsing response failed.",r[A]="File is too large.",r[E]="Image file type is invalid.",r[7]="Files can be uploaded only to same domain in IE 8 and IE 9.";var fe=!(r[8]="Image file is corrupted.");function pe(){fe=!0}function ge(){fe=!1}function de(e,t,a){!u.opts.htmlUntouched&&u.opts.useClasses?(e.removeClass("fr-fil fr-fir fr-dib fr-dii"),a&&e.addClass("fr-fi"+a[0]),t&&e.addClass("fr-di"+t[0])):"inline"==t?(e.css({display:"inline-block",verticalAlign:"bottom",margin:u.opts.imageDefaultMargin}),"center"==a?e.css({float:"none",marginBottom:"",marginTop:"",maxWidth:"calc(100% - "+2*u.opts.imageDefaultMargin+"px)",textAlign:"center"}):"left"==a?e.css({float:"left",marginLeft:0,maxWidth:"calc(100% - "+u.opts.imageDefaultMargin+"px)",textAlign:"left"}):e.css({float:"right",marginRight:0,maxWidth:"calc(100% - "+u.opts.imageDefaultMargin+"px)",textAlign:"right"})):"block"==t&&(e.css({display:"block",float:"none",verticalAlign:"top",margin:u.opts.imageDefaultMargin+"px auto",textAlign:"center"}),"left"==a?e.css({marginLeft:0,textAlign:"left"}):"right"==a&&e.css({marginRight:0,textAlign:"right"}))}function ce(e){if(void 0===e&&(e=be()),e){if(e.hasClass("fr-fil"))return"left";if(e.hasClass("fr-fir"))return"right";if(e.hasClass("fr-dib")||e.hasClass("fr-dii"))return"center";var t=e.css("float");if(e.css("float","none"),"block"==e.css("display")){if(e.css("float",""),e.css("float")!=t&&e.css("float",t),0===parseInt(e.css("margin-left"),10))return"left";if(0===parseInt(e.css("margin-right"),10))return"right"}else{if(e.css("float",""),e.css("float")!=t&&e.css("float",t),"left"==e.css("float"))return"left";if("right"==e.css("float"))return"right"}}return"center"}function me(e){void 0===e&&(e=be());var t=e.css("float");return e.css("float","none"),"block"==e.css("display")?(e.css("float",""),e.css("float")!=t&&e.css("float",t),"block"):(e.css("float",""),e.css("float")!=t&&e.css("float",t),"inline")}function ue(){var e=u.popups.get("image.insert");e=e||V(),u.popups.isVisible("image.insert")||(O(),u.popups.refresh("image.insert"),u.popups.setContainer("image.insert",u.$sc));var t=be();ye()&&(t=t.find(".fr-img-wrap"));var a=t.offset().left+t.outerWidth()/2,i=t.offset().top+t.outerHeight();u.popups.show("image.insert",a,i,t.outerHeight(!0),!0)}function he(){if(h){u.events.disableBlur(),u.selection.clear();var e=u.doc.createRange();e.selectNode(h.get(0)),u.browser.msie&&e.collapse(!0),u.selection.get().addRange(e),u.events.enableBlur()}}function ve(){return h}function be(){return ye()?h.parents(".fr-img-caption").first():h}function ye(){return!!h&&0<h.parents(".fr-img-caption").length}return{_init:function(){var i;u.events.$on(u.$el,u._mousedown,"IMG"==u.el.tagName?null:'img:not([contenteditable="false"])',function(e){if("false"==v(this).parents("contenteditable").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;u.helpers.isMobile()||u.selection.clear(),t=!0,u.popups.areVisible()&&u.events.disableBlur(),u.browser.msie&&(u.events.disableBlur(),u.$el.attr("contenteditable",!1)),u.draggable||"touchstart"==e.type||e.preventDefault(),e.stopPropagation()}),u.events.$on(u.$el,u._mousedown,".fr-img-caption .fr-inner",function(e){u.core.hasFocus()||u.events.focus(),e.stopPropagation()}),u.events.$on(u.$el,"paste",".fr-img-caption .fr-inner",function(e){u.toolbar.hide(),e.stopPropagation()}),u.events.$on(u.$el,u._mouseup,"IMG"==u.el.tagName?null:'img:not([contenteditable="false"])',function(e){if("false"==v(this).parents("contenteditable").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;t&&(t=!1,e.stopPropagation(),u.browser.msie&&(u.$el.attr("contenteditable",!0),u.events.enableBlur()))}),u.events.on("keyup",function(e){if(e.shiftKey&&""===u.selection.text().replace(/\n/g,"")&&u.keys.isArrow(e.which)){var t=u.selection.element(),a=u.selection.endElement();t&&"IMG"==t.tagName?B(v(t)):a&&"IMG"==a.tagName&&B(v(a))}},!0),u.events.on("drop",G),u.events.on("element.beforeDrop",W),u.events.on("mousedown window.mousedown",pe),u.events.on("window.touchmove",ge),u.events.on("mouseup window.mouseup",function(){if(h)return le(),!1;ge()}),u.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&le()}),u.events.on("image.resizeEnd",function(){u.opts.iframe&&u.size.syncIframe()}),u.events.on("blur image.hideResizer commands.undo commands.redo element.dropped",function(){le(!(t=!1))}),u.events.on("modals.hide",function(){h&&(he(),u.selection.clear())}),u.events.on("image.resizeEnd",function(){u.win.getSelection&&B(h)}),u.opts.imageAddNewLine&&u.events.on("image.inserted",function(e){var t=e.get(0);for(t.nextSibling&&"BR"===t.nextSibling.tagName&&(t=t.nextSibling);t&&!u.node.isElement(t);)t=u.node.isLastSibling(t)?t.parentNode:null;u.node.isElement(t)&&(u.opts.enter===we.ENTER_BR?e.after("<br>"):v(u.node.blockParent(e.get(0))).after("<"+u.html.defaultTag()+"><br></"+u.html.defaultTag()+">"))}),"IMG"==u.el.tagName&&u.$el.addClass("fr-view"),u.events.$on(u.$el,u.helpers.isMobile()&&!u.helpers.isWindowsPhone()?"touchend":"click","IMG"==u.el.tagName?null:'img:not([contenteditable="false"])',oe),u.helpers.isMobile()&&(u.events.$on(u.$el,"touchstart","IMG"==u.el.tagName?null:'img:not([contenteditable="false"])',function(){a=!1}),u.events.$on(u.$el,"touchmove",function(){a=!0})),u.$wp?(u.events.on("window.keydown keydown",ee,!0),u.events.on("keyup",function(e){if(h&&e.which==we.KEYCODE.ENTER)return!1},!0),u.events.$on(u.$el,"keydown",function(){var e=u.selection.element();(e.nodeType===Node.TEXT_NODE||"BR"==e.tagName&&u.node.isLastSibling(e))&&(e=e.parentNode),u.node.hasClass(e,"fr-inner")||(u.node.hasClass(e,"fr-img-caption")||(e=v(e).parents(".fr-img-caption").get(0)),u.node.hasClass(e,"fr-img-caption")&&(v(e).after(we.INVISIBLE_SPACE+we.MARKERS),u.selection.restore()))})):u.events.$on(u.$win,"keydown",ee),u.events.on("toolbar.esc",function(){if(h){if(u.$wp)u.events.disableBlur(),u.events.focus();else{var e=h;le(!0),u.selection.setAfter(e.get(0)),u.selection.restore()}return!1}},!0),u.events.on("toolbar.focusEditor",function(){if(h)return!1},!0),u.events.on("window.cut window.copy",function(e){if(h&&u.popups.isVisible("image.edit")&&!u.popups.get("image.edit").find(":focus").length){var t=be();ye()?(t.before(we.START_MARKER),t.after(we.END_MARKER),u.selection.restore(),u.paste.saveCopiedText(t.get(0).outerHTML,t.text())):(he(),u.paste.saveCopiedText(h.get(0).outerHTML,h.attr("alt"))),"copy"==e.type?setTimeout(function(){B(h)}):(le(!0),u.undo.saveStep(),setTimeout(function(){u.undo.saveStep()},0))}},!0),u.browser.msie&&u.events.on("keydown",function(e){if(!u.selection.isCollapsed()||!h)return!0;var t=e.which;t==we.KEYCODE.C&&u.keys.ctrlKey(e)?u.events.trigger("window.copy"):t==we.KEYCODE.X&&u.keys.ctrlKey(e)&&u.events.trigger("window.cut")}),u.events.$on(v(u.o_win),"keydown",function(e){var t=e.which;if(h&&t==we.KEYCODE.BACKSPACE)return e.preventDefault(),!1}),u.events.$on(u.$win,"keydown",function(e){var t=e.which;h&&h.hasClass("fr-uploading")&&t==we.KEYCODE.ESC&&h.trigger("abortUpload")}),u.events.on("destroy",function(){h&&h.hasClass("fr-uploading")&&h.trigger("abortUpload")}),u.events.on("paste.before",ne),u.events.on("paste.beforeCleanup",se),u.events.on("paste.after",ie),u.events.on("html.set",e),u.events.on("html.inserted",e),e(),u.events.on("destroy",function(){p=[]}),u.events.on("html.processGet",te),u.opts.imageOutputSize&&u.events.on("html.beforeGet",function(){i=u.el.querySelectorAll("img");for(var e=0;e<i.length;e++){var t=i[e].style.width||v(i[e]).width(),a=i[e].style.height||v(i[e]).height();t&&i[e].setAttribute("width",(""+t).replace(/px/,"")),a&&i[e].setAttribute("height",(""+a).replace(/px/,""))}}),u.opts.iframe&&u.events.on("image.loaded",u.size.syncIframe),u.$wp&&(c(),u.events.on("contentChanged",c)),u.events.$on(v(u.o_win),"orientationchange.image",function(){setTimeout(function(){h&&B(h)},100)}),I(!0),V(!0),Q(!0),F(!0),u.events.on("node.remove",function(e){if("IMG"==e.get(0).tagName)return Z(e),!1})},showInsertPopup:function(){var e=u.$tb.find('.fr-command[data-cmd="insertImage"]'),t=u.popups.get("image.insert");if(t=t||V(),O(),!t.hasClass("fr-active"))if(u.popups.refresh("image.insert"),u.popups.setContainer("image.insert",u.$tb),e.isVisible()){var a=u.button.getPosition(e),i=a.left,r=a.top;u.popups.show("image.insert",i,r,e.outerHeight())}else u.position.forSelection(t),u.popups.show("image.insert")},showLayer:function(e){var t,a,i=u.popups.get("image.insert");if(h||u.opts.toolbarInline){if(h){var r=be();ye()&&(r=r.find(".fr-img-wrap")),a=r.offset().top+r.outerHeight(),t=r.offset().left}}else{var n=u.$tb.find('.fr-command[data-cmd="insertImage"]');t=n.offset().left,a=n.offset().top+(u.opts.toolbarBottom?10:n.outerHeight()-10)}!h&&u.opts.toolbarInline&&(a=i.offset().top-u.helpers.getPX(i.css("margin-top")),i.hasClass("fr-above")&&(a+=i.outerHeight())),i.find(".fr-layer").removeClass("fr-active"),i.find(".fr-"+e+"-layer").addClass("fr-active"),u.popups.show("image.insert",t,a,h?h.outerHeight():0),u.accessibility.focusPopup(i)},refreshUploadButton:function(e){var t=u.popups.get("image.insert");t&&t.find(".fr-image-upload-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},refreshByURLButton:function(e){var t=u.popups.get("image.insert");t&&t.find(".fr-image-by-url-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},upload:Y,insertByURL:function(){var e=u.popups.get("image.insert").find(".fr-image-by-url-layer input");if(0<e.val().length){P(),k(u.language.translate("Loading image"));var t=e.val().trim();if(u.opts.imageUploadRemoteUrls&&u.opts.imageCORSProxy&&u.opts.imageUpload){var a=new XMLHttpRequest;a.onload=function(){200==this.status?Y([new Blob([this.response],{type:this.response.type||"image/png"})],h):U(i)},a.onerror=function(){_(t,!0,[],h)},a.open("GET",u.opts.imageCORSProxy+"/"+t,!0),a.responseType="blob",a.send()}else _(t,!0,[],h);e.val(""),e.blur()}},align:function(e){var t=be();t.removeClass("fr-fir fr-fil"),!u.opts.htmlUntouched&&u.opts.useClasses?"left"==e?t.addClass("fr-fil"):"right"==e&&t.addClass("fr-fir"):de(t,me(),e),he(),S(),n(),u.selection.clear()},refreshAlign:function(e){h&&e.find("> *").first().replaceWith(u.icon.create("image-align-"+ce()))},refreshAlignOnShow:function(e,t){h&&t.find('.fr-command[data-param1="'+ce()+'"]').addClass("fr-active").attr("aria-selected",!0)},display:function(e){var t=be();t.removeClass("fr-dii fr-dib"),!u.opts.htmlUntouched&&u.opts.useClasses?"inline"==e?t.addClass("fr-dii"):"block"==e&&t.addClass("fr-dib"):de(t,e,ce()),he(),S(),n(),u.selection.clear()},refreshDisplayOnShow:function(e,t){h&&t.find('.fr-command[data-param1="'+me()+'"]').addClass("fr-active").attr("aria-selected",!0)},replace:ue,back:function(){h?(u.events.disableBlur(),v(".fr-popup input:focus").blur(),B(h)):(u.events.disableBlur(),u.selection.restore(),u.events.enableBlur(),u.popups.hide("image.insert"),u.toolbar.showInline())},get:ve,getEl:be,insert:_,showProgressBar:P,remove:Z,hideProgressBar:O,applyStyle:function(e,t,a){if(void 0===t&&(t=u.opts.imageStyles),void 0===a&&(a=u.opts.imageMultipleStyles),!h)return!1;var i=be();if(!a){var r=Object.keys(t);r.splice(r.indexOf(e),1),i.removeClass(r.join(" "))}"object"==Ce(t[e])?(i.removeAttr("style"),i.css(t[e].style)):i.toggleClass(e),B(h)},showAltPopup:X,showSizePopup:q,setAlt:function(e){if(h){var t=u.popups.get("image.alt");h.attr("alt",e||t.find("input").val()||""),t.find("input:focus").blur(),B(h)}},setSize:function(e,t){if(h){var a=u.popups.get("image.size");e=e||a.find('input[name="width"]').val()||"",t=t||a.find('input[name="height"]').val()||"";var i=/^[\d]+((px)|%)*$/g;h.removeAttr("width").removeAttr("height"),e.match(i)?h.css("width",e):h.css("width",""),t.match(i)?h.css("height",t):h.css("height",""),ye()&&(h.parents(".fr-img-caption").removeAttr("width").removeAttr("height"),e.match(i)?h.parents(".fr-img-caption").css("width",e):h.parents(".fr-img-caption").css("width",""),t.match(i)?h.parents(".fr-img-caption").css("height",t):h.parents(".fr-img-caption").css("height","")),a&&a.find("input:focus").blur(),B(h)}},toggleCaption:function(){var e;if(h&&!ye()){var t,a;(e=h).parent().is("a")&&(e=h.parent()),e.attr("style")&&(a=-1<(t=e.attr("style").split(":")).indexOf("width")?t[t.indexOf("width")+1].replace(";",""):"");var i=u.opts.imageResizeWithPercent?(-1<a.indexOf("px")?null:a)||"100%":h.width()+"px";e.wrap("<span "+(u.browser.mozilla?"":'contenteditable="false"')+'class="fr-img-caption '+h.attr("class")+'" style="'+(u.opts.useClasses?"":e.attr("style"))+'" draggable="false"></span>'),e.wrap('<span class="fr-img-wrap"></span>'),h.after('<span class="fr-inner"'+(u.browser.mozilla?"":' contenteditable="true"')+">"+we.START_MARKER+u.language.translate("Image Caption")+we.END_MARKER+"</span>"),h.removeAttr("class").removeAttr("style").removeAttr("width"),h.parents(".fr-img-caption").css("width",i),le(!0),u.selection.restore()}else e=be(),h.insertAfter(e),h.attr("class",e.attr("class").replace("fr-img-caption","")).attr("style",e.attr("style")),e.remove(),B(h)},hasCaption:ye,exitEdit:le,edit:B}},we.DefineIcon("insertImage",{NAME:"image",SVG_KEY:"insertImage"}),we.RegisterShortcut(we.KEYCODE.P,"insertImage",null,"P"),we.RegisterCommand("insertImage",{title:"Insert Image",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()},plugin:"image"}),we.DefineIcon("imageUpload",{NAME:"upload",SVG_KEY:"upload"}),we.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-upload")},refresh:function(e){this.image.refreshUploadButton(e)}}),we.DefineIcon("imageByURL",{NAME:"link",SVG_KEY:"insertLink"}),we.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-by-url")},refresh:function(e){this.image.refreshByURLButton(e)}}),we.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function(e){this.image.get()?e.text(this.language.translate("Replace")):e.text(this.language.translate("Insert"))}}),we.DefineIcon("imageDisplay",{NAME:"star",SVG_KEY:"imageDisplay"}),we.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.image.display(t)},refresh:function(e){this.opts.imageTextNear||e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.image.refreshDisplayOnShow(e,t)}}),we.DefineIcon("image-align",{NAME:"align-left",SVG_KEY:"alignLeft"}),we.DefineIcon("image-align-left",{NAME:"align-left",SVG_KEY:"alignLeft"}),we.DefineIcon("image-align-right",{NAME:"align-right",SVG_KEY:"alignRight"}),we.DefineIcon("image-align-center",{NAME:"align-justify",SVG_KEY:"alignCenter"}),we.DefineIcon("imageAlign",{NAME:"align-justify",SVG_KEY:"alignJustify"}),we.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=we.COMMANDS.imageAlign.options;for(var a in t)t.hasOwnProperty(a)&&(e+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="imageAlign" data-param1="'+a+'" title="'+this.language.translate(t[a])+'">'+this.icon.create("image-align-"+a)+'<span class="fr-sr-only">'+this.language.translate(t[a])+"</span></a></li>");return e+"</ul>"},callback:function(e,t){this.image.align(t)},refresh:function(e){this.image.refreshAlign(e)},refreshOnShow:function(e,t){this.image.refreshAlignOnShow(e,t)}}),we.DefineIcon("imageReplace",{NAME:"exchange",FA5NAME:"exchange-alt",SVG_KEY:"replaceImage"}),we.RegisterCommand("imageReplace",{title:"Replace",undo:!1,focus:!1,popup:!0,refreshAfterCallback:!1,callback:function(){this.image.replace()}}),we.DefineIcon("imageRemove",{NAME:"trash",SVG_KEY:"remove"}),we.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}}),we.DefineIcon("imageBack",{NAME:"arrow-left",SVG_KEY:"back"}),we.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function(e){this.$,this.image.get()||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),we.RegisterCommand("imageDismissError",{title:"OK",undo:!1,callback:function(){this.image.hideProgressBar(!0)}}),we.DefineIcon("imageStyle",{NAME:"magic",SVG_KEY:"imageClass"}),we.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.imageStyles;for(var a in t)if(t.hasOwnProperty(a)){var i=t[a];"object"==Ce(i)&&(i=i.title),e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="imageStyle" data-param1="'+a+'">'+this.language.translate(i)+"</a></li>"}return e+"</ul>"},callback:function(e,t){this.image.applyStyle(t)},refreshOnShow:function(e,t){var a=this.$,i=this.image.getEl();i&&t.find(".fr-command").each(function(){var e=a(this).data("param1"),t=i.hasClass(e);a(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),we.DefineIcon("imageAlt",{NAME:"info",SVG_KEY:"imageAltText"}),we.RegisterCommand("imageAlt",{undo:!1,focus:!1,popup:!0,title:"Alternative Text",callback:function(){this.image.showAltPopup()}}),we.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}}),we.DefineIcon("imageSize",{NAME:"arrows-alt",SVG_KEY:"imageSize"}),we.RegisterCommand("imageSize",{undo:!1,focus:!1,popup:!0,title:"Change Size",callback:function(){this.image.showSizePopup()}}),we.RegisterCommand("imageSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setSize()}}),we.DefineIcon("imageCaption",{NAME:"commenting",FA5NAME:"comment-alt",SVG_KEY:"imageCaption"}),we.RegisterCommand("imageCaption",{undo:!0,focus:!1,title:"Image Caption",refreshAfterCallback:!0,callback:function(){this.image.toggleCaption()},refresh:function(e){this.image.get()&&e.toggleClass("fr-active",this.image.hasCaption())}})});