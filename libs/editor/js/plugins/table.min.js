!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(Z){"use strict";Z=Z&&Z.hasOwnProperty("default")?Z.default:Z,Object.assign(Z.POPUP_TEMPLATES,{"table.insert":"[_BUTTONS_][_ROWS_COLUMNS_]","table.edit":"[_BUTTONS_]","table.colors":"[_BUTTONS_][_COLORS_][_CUSTOM_COLOR_]"}),Object.assign(Z.DEFAULTS,{tableInsertMaxSize:10,tableEditButtons:["tableHeader","tableRemove","tableRows","tableColumns","tableStyle","-","tableCells","tableCellBackground","tableCellVerticalAlign","tableCellHorizontalAlign","tableCellStyle"],tableInsertButtons:["tableBack","|"],tableResizer:!0,tableDefaultWidth:"100%",tableResizerOffset:5,tableResizingLimit:30,tableColorsButtons:["tableBack","|"],tableColors:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],tableColorsStep:7,tableCellStyles:{"fr-highlighted":"Highlighted","fr-thick":"Thick"},tableStyles:{"fr-dashed-borders":"Dashed Borders","fr-alternate-rows":"Alternate Rows"},tableCellMultipleStyles:!0,tableMultipleStyles:!0,tableInsertHelper:!0,tableInsertHelperOffset:15}),Z.PLUGINS.table=function(E){var R,f,n,r,a,s,O,A=E.$;function h(){var e=x();if(e){var t=E.popups.get("table.edit");if(t=t||d()){E.popups.setContainer("table.edit",E.$sc);var l=M(e),a=l.left+(l.right-l.left)/2,n=l.bottom;E.popups.show("table.edit",a,n,l.bottom-l.top,!0),E.edit.isDisabled()&&(1<q().length&&E.toolbar.disable(),E.$el.removeClass("fr-no-selection"),E.edit.on(),E.button.bulkRefresh(),E.selection.setAtEnd(E.$el.find(".fr-selected-cell").last().get(0)),E.selection.restore())}}}function o(){0===q().length&&E.toolbar.enable()}function i(e){if(e)return E.popups.onHide("table.insert",function(){E.popups.get("table.insert").find('.fr-table-size .fr-select-table-size > span[data-row="1"][data-col="1"]').trigger("mouseover")}),!0;var t="";0<E.opts.tableInsertButtons.length&&(t='<div class="fr-buttons fr-tabs">'+E.button.buildList(E.opts.tableInsertButtons)+"</div>");var l,a={buttons:t,rows_columns:function(){for(var e='<div class="fr-table-size"><div class="fr-table-size-info">1 &times; 1</div><div class="fr-select-table-size">',t=1;t<=E.opts.tableInsertMaxSize;t++){for(var l=1;l<=E.opts.tableInsertMaxSize;l++){var a="inline-block";2<t&&!E.helpers.isMobile()&&(a="none");var n="fr-table-cell ";1==t&&1==l&&(n+=" hover"),e+='<span class="fr-command '+n+'" tabIndex="-1" data-cmd="tableInsert" data-row="'+t+'" data-col="'+l+'" data-param1="'+t+'" data-param2="'+l+'" style="display: '+a+';" role="button"><span></span><span class="fr-sr-only">'+t+" &times; "+l+"&nbsp;&nbsp;&nbsp;</span></span>"}e+='<div class="new-line"></div>'}return e+"</div></div>"}()},n=E.popups.create("table.insert",a);return E.events.$on(n,"mouseover",".fr-table-size .fr-select-table-size .fr-table-cell",function(e){c(A(e.currentTarget))},!0),l=n,E.events.$on(l,"focus","[tabIndex]",function(e){c(A(e.currentTarget))}),E.events.on("popup.tab",function(e){var t=A(e.currentTarget);if(!E.popups.isVisible("table.insert")||!t.is("span, a"))return!0;var l,a=e.which;if(Z.KEYCODE.ARROW_UP==a||Z.KEYCODE.ARROW_DOWN==a||Z.KEYCODE.ARROW_LEFT==a||Z.KEYCODE.ARROW_RIGHT==a){if(t.is("span.fr-table-cell")){var n=t.parent().find("span.fr-table-cell"),r=n.index(t),s=E.opts.tableInsertMaxSize,o=r%s,i=Math.floor(r/s);Z.KEYCODE.ARROW_UP==a?i=Math.max(0,i-1):Z.KEYCODE.ARROW_DOWN==a?i=Math.min(E.opts.tableInsertMaxSize-1,i+1):Z.KEYCODE.ARROW_LEFT==a?o=Math.max(0,o-1):Z.KEYCODE.ARROW_RIGHT==a&&(o=Math.min(E.opts.tableInsertMaxSize-1,o+1));var f=i*s+o,d=A(n.get(f));c(d),E.events.disableBlur(),d.focus(),l=!1}}else Z.KEYCODE.ENTER==a&&(E.button.exec(t),l=!1);return!1===l&&(e.preventDefault(),e.stopPropagation()),l},!0),n}function c(e){var t=e.data("row");null!==t&&(t=parseInt(t));var l=e.data("col");null!==l&&(l=parseInt(l));var a=e.parent();a.siblings(".fr-table-size-info").html(t+" &times; "+l),a.find("> span").removeClass("hover fr-active-item");for(var n=1;n<=E.opts.tableInsertMaxSize;n++)for(var r=0;r<=E.opts.tableInsertMaxSize;r++){var s=a.find('> span[data-row="'+n+'"][data-col="'+r+'"]');n<=t&&r<=l?s.addClass("hover"):n<=t+1||n<=2&&!E.helpers.isMobile()?s.css("display","inline-block"):2<n&&!E.helpers.isMobile()&&s.css("display","none")}e.addClass("fr-active-item")}function d(e){if(e)return E.popups.onHide("table.edit",o),!0;if(0<E.opts.tableEditButtons.length){var t={buttons:'<div class="fr-buttons">'.concat(E.button.buildList(E.opts.tableEditButtons),"</div>")},l=E.popups.create("table.edit",t);return E.events.$on(E.$wp,"scroll.table-edit",function(){E.popups.isVisible("table.edit")&&h()}),l}return!1}function p(){if(0<q().length){var e=J();E.selection.setBefore(e.get(0))||E.selection.setAfter(e.get(0)),E.selection.restore(),E.popups.hide("table.edit"),e.remove(),E.toolbar.enable()}}function u(e){var t=J();if(0<t.length){if(0<E.$el.find("th.fr-selected-cell").length&&"above"==e)return;var l,a,n,r=x(),s=y(r);if(null==s)return;a="above"==e?s.min_i:s.max_i;var o="<tr>";for(l=0;l<r[a].length;l++)if("below"==e&&a<r.length-1&&r[a][l]==r[a+1][l]||"above"==e&&0<a&&r[a][l]==r[a-1][l]){if(0===l||0<l&&r[a][l]!=r[a][l-1]){var i=A(r[a][l]);i.attr("rowspan",parseInt(i.attr("rowspan"),10)+1)}}else o+='<td style="'+A(r[a][l]).attr("style")+'" ><br></td>';o+="</tr>",n=0<E.$el.find("th.fr-selected-cell").length&&"below"==e?A(t.find("tbody").not(t.find("> table tbody"))):A(t.find("tr").not(t.find("> table tr")).get(a)),"below"==e?"TBODY"==n.attr("tagName")?n.prepend(o):n[0].parentNode&&n[0].insertAdjacentHTML("afterend",o):"above"==e&&(n.before(o),E.popups.isVisible("table.edit")&&h())}}function b(e,t,l){var a,n,r,s,o,i=0,f=x(l);if(e<(t=Math.min(t,f[0].length-1)))for(n=e;n<=t;n++)if(!(e<n&&f[0][n]==f[0][n-1])&&1<(s=Math.min(parseInt(f[0][n].getAttribute("colspan"),10)||1,t-e+1))&&f[0][n]==f[0][n+1])for(i=s-1,a=1;a<f.length;a++)if(f[a][n]!=f[a-1][n]){for(r=n;r<n+s;r++)if(1<(o=parseInt(f[a][r].getAttribute("colspan"),10)||1)&&f[a][r]==f[a][r+1])r+=i=Math.min(i,o-1);else if(!(i=Math.max(0,i-1)))break;if(!i)break}i&&m(f,i,"colspan",0,f.length-1,e,t)}function g(e,t,l){var a,n,r,s,o,i=0,f=x(l);if(e<(t=Math.min(t,f.length-1)))for(a=e;a<=t;a++)if(!(e<a&&f[a][0]==f[a-1][0])&&1<(s=Math.min(parseInt(f[a][0].getAttribute("rowspan"),10)||1,t-e+1))&&f[a][0]==f[a+1][0])for(i=s-1,n=1;n<f[0].length;n++)if(f[a][n]!=f[a][n-1]){for(r=a;r<a+s;r++)if(1<(o=parseInt(f[r][n].getAttribute("rowspan"),10)||1)&&f[r][n]==f[r+1][n])r+=i=Math.min(i,o-1);else if(!(i=Math.max(0,i-1)))break;if(!i)break}i&&m(f,i,"rowspan",e,t,0,f[0].length-1)}function m(e,t,l,a,n,r,s){var o,i,f;for(o=a;o<=n;o++)for(i=r;i<=s;i++)a<o&&e[o][i]==e[o-1][i]||r<i&&e[o][i]==e[o][i-1]||1<(f=parseInt(e[o][i].getAttribute(l),10)||1)&&(1<f-t?e[o][i].setAttribute(l,f-t):e[o][i].removeAttribute(l))}function v(e,t,l,a,n){g(e,t,n),b(l,a,n)}function t(e){var t=E.$el.find(".fr-selected-cell");"REMOVE"!=e?t.css("background-color",E.helpers.HEXtoRGB(e)):t.css("background-color",""),h()}function x(e){var f=[];return null==(e=e||null)&&0<q().length&&(e=J()),e&&e.findVisible("tr").not(e.find("> table tr")).each(function(o,e){var t=A(e),i=0;t.find("> th, > td").each(function(e,t){for(var l=A(t),a=parseInt(l.attr("colspan"),10)||1,n=parseInt(l.attr("rowspan"),10)||1,r=o;r<o+n;r++)for(var s=i;s<i+a;s++)f[r]||(f[r]=[]),f[r][s]?i++:f[r][s]=t;i+=a})}),f}function _(e,t){for(var l=0;l<t.length;l++)for(var a=0;a<t[l].length;a++)if(t[l][a]==e)return{row:l,col:a}}function $(e,t,l){for(var a=e+1,n=t+1;a<l.length;){if(l[a][t]!=l[e][t]){a--;break}a++}for(a==l.length&&a--;n<l[e].length;){if(l[e][n]!=l[e][t]){n--;break}n++}return n==l[e].length&&n--,{row:a,col:n}}function w(){E.el.querySelector(".fr-cell-fixed")&&E.el.querySelector(".fr-cell-fixed").classList.remove("fr-cell-fixed"),E.el.querySelector(".fr-cell-handler")&&E.el.querySelector(".fr-cell-handler").classList.remove("fr-cell-handler")}function C(){var e=E.$el.find(".fr-selected-cell");0<e.length&&e.each(function(){var e=A(this);e.removeClass("fr-selected-cell"),""===e.attr("class")&&e.removeAttr("class")}),w()}function D(){E.events.disableBlur(),E.selection.clear(),E.$el.addClass("fr-no-selection"),E.$el.blur(),E.events.enableBlur()}function y(e){var t=E.$el.find(".fr-selected-cell");if(0<t.length){var l,a=e.length,n=0,r=e[0].length,s=0;for(l=0;l<t.length;l++){var o=_(t[l],e),i=$(o.row,o.col,e);a=Math.min(o.row,a),n=Math.max(i.row,n),r=Math.min(o.col,r),s=Math.max(i.col,s)}return{min_i:a,max_i:n,min_j:r,max_j:s}}return null}function M(e){var t=y(e);if(null!=t){var l=A(e[t.min_i][t.min_j]),a=A(e[t.min_i][t.max_j]),n=A(e[t.max_i][t.min_j]);return{left:l.length&&l.offset().left,right:a.length&&a.offset().left+a.outerWidth(),top:l.length&&l.offset().top,bottom:n.length&&n.offset().top+n.outerHeight()}}}function S(e,t){if(A(e).is(t))C(),A(e).addClass("fr-selected-cell");else{D(),E.edit.off();var l=x(),a=_(e,l),n=_(t,l),r=function e(t,l,a,n,r){var s,o,i,f,d=t,c=l,p=a,h=n;for(s=d;s<=c;s++)(1<(parseInt(A(r[s][p]).attr("rowspan"),10)||1)||1<(parseInt(A(r[s][p]).attr("colspan"),10)||1))&&(f=$((i=_(r[s][p],r)).row,i.col,r),d=Math.min(i.row,d),c=Math.max(f.row,c),p=Math.min(i.col,p),h=Math.max(f.col,h)),(1<(parseInt(A(r[s][h]).attr("rowspan"),10)||1)||1<(parseInt(A(r[s][h]).attr("colspan"),10)||1))&&(f=$((i=_(r[s][h],r)).row,i.col,r),d=Math.min(i.row,d),c=Math.max(f.row,c),p=Math.min(i.col,p),h=Math.max(f.col,h));for(o=p;o<=h;o++)(1<(parseInt(A(r[d][o]).attr("rowspan"),10)||1)||1<(parseInt(A(r[d][o]).attr("colspan"),10)||1))&&(f=$((i=_(r[d][o],r)).row,i.col,r),d=Math.min(i.row,d),c=Math.max(f.row,c),p=Math.min(i.col,p),h=Math.max(f.col,h)),(1<(parseInt(A(r[c][o]).attr("rowspan"),10)||1)||1<(parseInt(A(r[c][o]).attr("colspan"),10)||1))&&(f=$((i=_(r[c][o],r)).row,i.col,r),d=Math.min(i.row,d),c=Math.max(f.row,c),p=Math.min(i.col,p),h=Math.max(f.col,h));return d==t&&c==l&&p==a&&h==n?{min_i:t,max_i:l,min_j:a,max_j:n}:e(d,c,p,h,r)}(Math.min(a.row,n.row),Math.max(a.row,n.row),Math.min(a.col,n.col),Math.max(a.col,n.col),l);C(),e.classList.add("fr-cell-fixed"),t.classList.add("fr-cell-handler");for(var s=r.min_i;s<=r.max_i;s++)for(var o=r.min_j;o<=r.max_j;o++)A(l[s][o]).addClass("fr-selected-cell")}}function I(e){var t=null,l=A(e.target);return"TD"==e.target.tagName||"TH"==e.target.tagName?t=e.target:0<l.closest("td",l.closest("tr")[0]).length?t=l.closest("td",l.closest("tr")[0]).get(0):0<l.closest("th",l.closest("thead")[0]).length&&(t=l.closest("th",l.closest("thead")[0]).get(0)),-1===E.$el.html.toString().search(t)?null:t}function N(){C(),E.popups.hide("table.edit")}function e(e){var t=I(e);if("false"==A(t).parents("[contenteditable]").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;if(0<q().length&&!t&&N(),!E.edit.isDisabled()||E.popups.isVisible("table.edit"))if(1!=e.which||1==e.which&&E.helpers.isMac()&&e.ctrlKey)(3==e.which||1==e.which&&E.helpers.isMac()&&e.ctrlKey)&&t&&N();else if(r=!0,t){0<q().length&&!e.shiftKey&&N(),e.stopPropagation(),E.events.trigger("image.hideResizer"),E.events.trigger("video.hideResizer"),n=!0;var l=t.tagName.toLowerCase();e.shiftKey&&0<E.$el.find(l+".fr-selected-cell").length?A(E.$el.find(l+".fr-selected-cell").closest("table")).is(A(t).closest("table"))?S(a,t):D():((E.keys.ctrlKey(e)||e.shiftKey)&&(1<q().length||0===A(t).find(E.selection.element()).length&&!A(t).is(E.selection.element()))&&D(),a=t,0<E.opts.tableEditButtons.length&&S(a,a))}}function l(e){if(E.popups.areVisible())return!0;if(n||E.$tb.is(e.target)||E.$tb.is(A(e.target).closest(".fr-toolbar"))||(0<q().length&&E.toolbar.enable(),C()),!(1!=e.which||1==e.which&&E.helpers.isMac()&&e.ctrlKey)&&(r=!1,n&&(n=!1,I(e)||1!=q().length?0<q().length&&(E.selection.isCollapsed()?h():(C(),E.edit.on())):C()),O)){O=!1,R.removeClass("fr-moving"),E.$el.removeClass("fr-no-selection"),E.edit.on();var t=parseFloat(R.css("left"))+E.opts.tableResizerOffset+E.$wp.offset().left;E.opts.iframe&&(t-=E.$iframe.offset().left),R.data("release-position",t),R.removeData("max-left"),R.removeData("max-right"),function(){var e=R.data("origin"),t=R.data("release-position");if(e!==t){var l=R.data("first"),a=R.data("second"),n=R.data("table"),r=n.outerWidth();if(E.undo.canDo()||E.undo.saveStep(),null!=l&&null!=a){var s,o,i,f=x(n),d=[],c=[],p=[],h=[];for(s=0;s<f.length;s++)o=A(f[s][l]),i=A(f[s][a]),d[s]=o.outerWidth(),p[s]=i.outerWidth(),c[s]=d[s]/r*100,h[s]=p[s]/r*100;for(s=0;s<f.length;s++)if(o=A(f[s][l]),i=A(f[s][a]),f[s][l]!=f[s][a]){var u=(c[s]*(d[s]+t-e)/d[s]).toFixed(4);o.css("width",u+"%"),i.css("width",(c[s]+h[s]-u).toFixed(4)+"%")}}else{var b,g=n.parent(),m=r/g.width()*100,v=(parseInt(n.css("margin-left"),10)||0)/g.width()*100,w=(parseInt(n.css("margin-right"),10)||0)/g.width()*100;"rtl"==E.opts.direction&&0===a||"rtl"!=E.opts.direction&&0!==a?(b=(r+t-e)/r*m,n.css("margin-right","calc(100% - "+Math.round(b).toFixed(4)+"% - "+Math.round(v).toFixed(4)+"%)")):("rtl"==E.opts.direction&&0!==a||"rtl"!=E.opts.direction&&0===a)&&(b=(r-t+e)/r*m,n.css("margin-left","calc(100% - "+Math.round(b).toFixed(4)+"% - "+Math.round(w).toFixed(4)+"%)")),n.css("width",Math.round(b).toFixed(4)+"%")}E.selection.restore(),E.undo.saveStep(),E.events.trigger("table.resized",[n.get(0)])}R.removeData("origin"),R.removeData("release-position"),R.removeData("first"),R.removeData("second"),R.removeData("table")}(),k()}}function T(e){if(!0===n&&0<E.opts.tableEditButtons.length){if(A(e.currentTarget).closest("table").is(J())){if("TD"==e.currentTarget.tagName&&0===E.$el.find("th.fr-selected-cell").length)return void S(a,e.currentTarget);if("TH"==e.currentTarget.tagName&&0===E.$el.find("td.fr-selected-cell").length)return void S(a,e.currentTarget)}D()}}function K(e,t,l,a){for(var n,r=t;r!=E.el&&"TD"!=r.tagName&&"TH"!=r.tagName&&("up"==a?n=r.previousElementSibling:"down"==a&&(n=r.nextElementSibling),!n);)r=r.parentNode;"TD"==r.tagName||"TH"==r.tagName?function(e,t){for(var l=e;l&&"TABLE"!=l.tagName&&l.parentNode!=E.el;)l=l.parentNode;if(l&&"TABLE"==l.tagName){var a=x(A(l));"up"==t?B(_(e,a),l,a):"down"==t&&z(_(e,a),l,a)}}(r,a):n&&("up"==a&&E.selection.setAtEnd(n),"down"==a&&E.selection.setAtStart(n))}function B(e,t,l){0<e.row?E.selection.setAtEnd(l[e.row-1][e.col]):K(0,t,0,"up")}function z(e,t,l){var a=parseInt(l[e.row][e.col].getAttribute("rowspan"),10)||1;e.row<l.length-a?E.selection.setAtStart(l[e.row+a][e.col]):K(0,t,0,"down")}function k(){R&&(R.find("div").css("opacity",0),R.css("top",0),R.css("left",0),R.css("height",0),R.find("div").css("height",0),R.hide())}function Y(){f&&f.removeClass("fr-visible").css("left","-9999px")}function W(e,t){if(E.$box.find(".fr-line-breaker").isVisible())return!1;f||G(),E.$box.append(f),f.data("instance",E);var l,a=A(t).find("tr").first(),n=e.pageX,r=0,s=0;if(E.opts.iframe){var o=E.helpers.getPX(E.$wp.find(".fr-iframe").css("padding-top")),i=E.helpers.getPX(E.$wp.find(".fr-iframe").css("padding-left"));r+=E.$iframe.offset().left-E.helpers.scrollLeft()+i,s+=E.$iframe.offset().top-E.helpers.scrollTop()+o}a.find("th, td").each(function(){var e=A(this);return e.offset().left<=n&&n<e.offset().left+e.outerWidth()/2?(l=parseInt(f.find("a").css("width"),10),f.css("top",s+e.offset().top-E.$box.offset().top-l-5),f.css("left",r+e.offset().left-E.$box.offset().left-l/2),f.data("selected-cell",e),f.data("position","before"),f.addClass("fr-visible"),!1):e.offset().left+e.outerWidth()/2<=n&&n<e.offset().left+e.outerWidth()?(l=parseInt(f.find("a").css("width"),10),f.css("top",s+e.offset().top-E.$box.offset().top-l-5),f.css("left",r+e.offset().left-E.$box.offset().left+e.outerWidth()-l/2),f.data("selected-cell",e),f.data("position","after"),f.addClass("fr-visible"),!1):void 0})}function L(e,t){if(E.$box.find(".fr-line-breaker").isVisible())return!1;f||G(),E.$box.append(f),f.data("instance",E);var l,a=A(t),n=e.pageY,r=0,s=0;if(E.opts.iframe){var o=E.helpers.getPX(E.$wp.find(".fr-iframe").css("padding-top")),i=E.helpers.getPX(E.$wp.find(".fr-iframe").css("padding-left"));r+=E.$iframe.offset().left-E.helpers.scrollLeft()+i,s+=E.$iframe.offset().top-E.helpers.scrollTop()+o}a.find("tr").each(function(){var e=A(this);return e.offset().top<=n&&n<e.offset().top+e.outerHeight()/2?(l=parseInt(f.find("a").css("width"),10),f.css("top",s+e.offset().top-E.$box.offset().top-l/2),f.css("left",r+e.offset().left-E.$box.offset().left-l-5),f.data("selected-cell",e.find("td").first()),f.data("position","above"),f.addClass("fr-visible"),!1):e.offset().top+e.outerHeight()/2<=n&&n<e.offset().top+e.outerHeight()?(l=parseInt(f.find("a").css("width"),10),f.css("top",s+e.offset().top-E.$box.offset().top+e.outerHeight()-l/2),f.css("left",r+e.offset().left-E.$box.offset().left-l-5),f.data("selected-cell",e.find("td").first()),f.data("position","below"),f.addClass("fr-visible"),!1):void 0})}function F(e){s=null;var t=E.doc.elementFromPoint(e.pageX-E.win.pageXOffset,e.pageY-E.win.pageYOffset);E.opts.tableResizer&&(!E.popups.areVisible()||E.popups.areVisible()&&E.popups.isVisible("table.edit"))&&function(e,t){var l=A(t),a=l.closest("table"),n=a.parent();if(t&&"TD"!=t.tagName&&"TH"!=t.tagName&&(0<l.closest("td").length?t=l.closest("td"):0<l.closest("th").length&&(t=l.closest("th"))),!t||"TD"!=t.tagName&&"TH"!=t.tagName)R&&l.get(0)!=R.get(0)&&l.parent().get(0)!=R.get(0)&&E.core.sameInstance(R)&&k();else{if(l=A(t),0===E.$el.find(l).length)return;var r=l.offset().left-1,s=r+l.outerWidth();if(Math.abs(e.pageX-r)<=E.opts.tableResizerOffset||Math.abs(s-e.pageX)<=E.opts.tableResizerOffset){var o,i,f,d,c,p=x(a),h=_(t,p),u=$(h.row,h.col,p),b=a.offset().top,g=a.outerHeight()-1;"rtl"!=E.opts.direction?e.pageX-r<=E.opts.tableResizerOffset?(f=r,0<h.col?(d=r-V(h.col-1,p)+E.opts.tableResizingLimit,c=r+V(h.col,p)-E.opts.tableResizingLimit,o=h.col-1,i=h.col):(o=null,i=0,d=a.offset().left-1-parseInt(a.css("margin-left"),10),c=a.offset().left-1+a.width()-p[0].length*E.opts.tableResizingLimit)):s-e.pageX<=E.opts.tableResizerOffset&&(f=s,u.col<p[u.row].length&&p[u.row][u.col+1]?(d=s-V(u.col,p)+E.opts.tableResizingLimit,c=s+V(u.col+1,p)-E.opts.tableResizingLimit,o=u.col,i=u.col+1):(o=u.col,i=null,d=a.offset().left-1+p[0].length*E.opts.tableResizingLimit,c=n.offset().left-1+n.width()+parseFloat(n.css("padding-left")))):s-e.pageX<=E.opts.tableResizerOffset?(f=s,0<h.col?(d=s-V(h.col,p)+E.opts.tableResizingLimit,c=s+V(h.col-1,p)-E.opts.tableResizingLimit,o=h.col,i=h.col-1):(o=null,i=0,d=a.offset().left+p[0].length*E.opts.tableResizingLimit,c=n.offset().left-1+n.width()+parseFloat(n.css("padding-left")))):e.pageX-r<=E.opts.tableResizerOffset&&(f=r,u.col<p[u.row].length&&p[u.row][u.col+1]?(d=r-V(u.col+1,p)+E.opts.tableResizingLimit,c=r+V(u.col,p)-E.opts.tableResizingLimit,o=u.col+1,i=u.col):(o=u.col,i=null,d=n.offset().left+parseFloat(n.css("padding-left")),c=a.offset().left-1+a.width()-p[0].length*E.opts.tableResizingLimit)),R||(E.shared.$table_resizer||(E.shared.$table_resizer=A(document.createElement("div")).attr("class","fr-table-resizer").html("<div></div>")),R=E.shared.$table_resizer,E.events.$on(R,"mousedown",function(e){return!E.core.sameInstance(R)||(0<q().length&&N(),1==e.which?(E.selection.save(),O=!0,R.addClass("fr-moving"),D(),E.edit.off(),R.find("div").css("opacity",1),!1):void 0)}),E.events.$on(R,"mousemove",function(e){if(!E.core.sameInstance(R))return!0;O&&(E.opts.iframe&&(e.pageX-=E.$iframe.offset().left),j(e))}),E.events.on("shared.destroy",function(){R.html("").removeData().remove(),R=null},!0),E.events.on("destroy",function(){E.$el.find(".fr-selected-cell").removeClass("fr-selected-cell"),A("body").first().append(R.hide())},!0)),R.data("table",a),R.data("first",o),R.data("second",i),R.data("instance",E),E.$wp.append(R);var m=f-E.win.pageXOffset-E.opts.tableResizerOffset-E.$wp.offset().left,v=b-E.$wp.offset().top+E.$wp.scrollTop();if(E.opts.iframe){var w=E.helpers.getPX(E.$wp.find(".fr-iframe").css("padding-top")),C=E.helpers.getPX(E.$wp.find(".fr-iframe").css("padding-left"));m+=E.$iframe.offset().left+C,v+=E.$iframe.offset().top+w,d+=E.$iframe.offset().left,c+=E.$iframe.offset().left}R.data("max-left",d),R.data("max-right",c),R.data("origin",f-E.win.pageXOffset),R.css("top",v),R.css("left",m),R.css("height",g),R.find("div").css("height",g),R.css("padding-left",E.opts.tableResizerOffset),R.css("padding-right",E.opts.tableResizerOffset),R.show()}else E.core.sameInstance(R)&&k()}}(e,t),!E.opts.tableInsertHelper||E.popups.areVisible()||E.$tb.hasClass("fr-inline")&&E.$tb.isVisible()||function(e,t){if(0===q().length){var l,a,n;if(t&&("HTML"==t.tagName||"BODY"==t.tagName||E.node.isElement(t)))for(l=1;l<=E.opts.tableInsertHelperOffset;l++){if(a=E.doc.elementFromPoint(e.pageX-E.win.pageXOffset,e.pageY-E.win.pageYOffset+l),A(a).hasClass("fr-tooltip"))return;if(a&&("TH"==a.tagName||"TD"==a.tagName||"TABLE"==a.tagName)&&(A(a).parents(".fr-wrapper").length||E.opts.iframe)&&"false"!=A(a).closest("table").attr("contenteditable"))return W(e,A(a).closest("table"));if(n=E.doc.elementFromPoint(e.pageX-E.win.pageXOffset+l,e.pageY-E.win.pageYOffset),A(n).hasClass("fr-tooltip"))return;if(n&&("TH"==n.tagName||"TD"==n.tagName||"TABLE"==n.tagName)&&(A(n).parents(".fr-wrapper").length||E.opts.iframe)&&"false"!=A(n).closest("table").attr("contenteditable"))return L(e,A(n).closest("table"))}E.core.sameInstance(f)&&Y()}}(e,t)}function H(){if(O){var e=R.data("table").offset().top-E.win.pageYOffset;if(E.opts.iframe){var t=E.helpers.getPX(E.$wp.find(".fr-iframe").css("padding-top"));e+=E.$iframe.offset().top-E.helpers.scrollTop()+t}R.css("top",e)}}function V(e,t){var l,a=A(t[0][e]).outerWidth();for(l=1;l<t.length;l++)a=Math.min(a,A(t[l][e]).outerWidth());return a}function P(e,t,l){var a,n=0;for(a=e;a<=t;a++)n+=V(a,l);return n}function j(e){if(1<q().length&&r&&D(),!1===r&&!1===n&&!1===O)s&&clearTimeout(s),E.edit.isDisabled()&&!E.popups.isVisible("table.edit")||(s=setTimeout(F,30,e));else if(O){var t=e.pageX-E.win.pageXOffset;E.opts.iframe&&(t+=E.$iframe.offset().left);var l=R.data("max-left"),a=R.data("max-right");l<=t&&t<=a?R.css("left",t-E.opts.tableResizerOffset-E.$wp.offset().left):t<l&&parseFloat(R.css("left"),10)>l-E.opts.tableResizerOffset?R.css("left",l-E.opts.tableResizerOffset-E.$wp.offset().left):a<t&&parseFloat(R.css("left"),10)<a-E.opts.tableResizerOffset&&R.css("left",a-E.opts.tableResizerOffset-E.$wp.offset().left)}else r&&Y()}function X(e){E.node.isEmpty(e.get(0))?e.prepend(Z.MARKERS):e.prepend(Z.START_MARKER).append(Z.END_MARKER)}function G(){E.shared.$ti_helper||(E.shared.$ti_helper=A(document.createElement("div")).attr("class","fr-insert-helper").html('<a class="fr-floating-btn" role="button" tabIndex="-1" title="'+E.language.translate("Insert")+'"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z"/></svg></a>'),E.events.bindClick(E.shared.$ti_helper,"a",function(){var e=f.data("selected-cell"),t=f.data("position"),l=f.data("instance")||E;"before"==t?(E.undo.saveStep(),e.addClass("fr-selected-cell"),l.table.insertColumn(t),e.removeClass("fr-selected-cell"),E.undo.saveStep()):"after"==t?(E.undo.saveStep(),e.addClass("fr-selected-cell"),l.table.insertColumn(t),e.removeClass("fr-selected-cell"),E.undo.saveStep()):"above"==t?(E.undo.saveStep(),e.addClass("fr-selected-cell"),l.table.insertRow(t),e.removeClass("fr-selected-cell"),E.undo.saveStep()):"below"==t&&(E.undo.saveStep(),e.addClass("fr-selected-cell"),l.table.insertRow(t),e.removeClass("fr-selected-cell"),E.undo.saveStep()),Y()}),E.events.on("shared.destroy",function(){E.shared.$ti_helper.html("").removeData().remove(),E.shared.$ti_helper=null},!0),E.events.$on(E.shared.$ti_helper,"mousemove",function(e){e.stopPropagation()},!0),E.events.$on(A(E.o_win),"scroll",function(){Y()},!0),E.events.$on(E.$wp,"scroll",function(){Y()},!0)),f=E.shared.$ti_helper,E.events.on("destroy",function(){f=null}),E.tooltip.bind(E.$box,".fr-insert-helper > a.fr-floating-btn")}function U(){a=null,clearTimeout(s)}function q(){return E.el.querySelectorAll(".fr-selected-cell")}function J(){var e=q();if(e.length){for(var t=e[0];t&&"TABLE"!=t.tagName&&t.parentNode!=E.el;)t=t.parentNode;return t&&"TABLE"==t.tagName?A(t):A([])}return A([])}return{_init:function(){if(!E.$wp)return!1;if(!E.helpers.isMobile()){O=n=r=!1,E.events.$on(E.$el,"mousedown",e),E.popups.onShow("image.edit",function(){C(),n=r=!1}),E.popups.onShow("link.edit",function(){C(),n=r=!1}),E.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&C()}),E.events.$on(E.$el,"mouseover","th, td",T),E.events.$on(E.$win,"mouseup",l),E.opts.iframe&&E.events.$on(A(E.o_win),"mouseup",l),E.events.$on(E.$win,"mousemove",j),E.events.$on(A(E.o_win),"scroll",H),E.events.on("contentChanged",function(){0<q().length&&(h(),E.$el.find("img").on("load.selected-cells",function(){A(this).off("load.selected-cells"),0<q().length&&h()}))}),E.events.$on(A(E.o_win),"resize",function(){C()}),E.events.on("toolbar.esc",function(){if(0<q().length)return E.events.disableBlur(),E.events.focus(),!1},!0),E.events.$on(A(E.o_win),"keydown",function(){r&&n&&(n=r=!1,E.$el.removeClass("fr-no-selection"),E.edit.on(),E.selection.setAtEnd(E.$el.find(".fr-selected-cell").last().get(0)),E.selection.restore(),C())}),E.events.$on(E.$el,"keydown",function(e){e.shiftKey?!1===function(e){var t=q();if(null!=t&&0<t.length){var l,a=x(),n=e.which,r=_(1==t.length?l=t[0]:(l=E.el.querySelector(".fr-cell-fixed"),E.el.querySelector(".fr-cell-handler")),a);if(Z.KEYCODE.ARROW_RIGHT==n){if(r.col<a[0].length-1)return S(l,a[r.row][r.col+1]),!1}else if(Z.KEYCODE.ARROW_DOWN==n){if(r.row<a.length-1)return S(l,a[r.row+1][r.col]),!1}else if(Z.KEYCODE.ARROW_LEFT==n){if(0<r.col)return S(l,a[r.row][r.col-1]),!1}else if(Z.KEYCODE.ARROW_UP==n&&0<r.row)return S(l,a[r.row-1][r.col]),!1}}(e)&&setTimeout(function(){h()},0):function(e){var t=e.which,l=E.selection.blocks();if(l.length&&("TD"==(l=l[0]).tagName||"TH"==l.tagName)){for(var a=l;a&&"TABLE"!=a.tagName&&a.parentNode!=E.el;)a=a.parentNode;if(a&&"TABLE"==a.tagName&&(Z.KEYCODE.ARROW_LEFT==t||Z.KEYCODE.ARROW_UP==t||Z.KEYCODE.ARROW_RIGHT==t||Z.KEYCODE.ARROW_DOWN==t)&&(0<q().length&&N(),E.browser.webkit&&(Z.KEYCODE.ARROW_UP==t||Z.KEYCODE.ARROW_DOWN==t))){var n=E.selection.ranges(0).startContainer;if(n.nodeType==Node.TEXT_NODE&&(Z.KEYCODE.ARROW_UP==t&&(n.previousSibling&&"BR"!==n.previousSibling.tagName||n.previousSibling&&"BR"===n.previousSibling.tagName&&n.previousSibling.previousSibling)||Z.KEYCODE.ARROW_DOWN==t&&(n.nextSibling&&"BR"!==n.nextSibling.tagName||n.nextSibling&&"BR"===n.nextSibling.tagName&&n.nextSibling.nextSibling)))return;e.preventDefault(),e.stopPropagation();var r=x(A(a)),s=_(l,r);Z.KEYCODE.ARROW_UP==t?B(s,a,r):Z.KEYCODE.ARROW_DOWN==t&&z(s,a,r),E.selection.restore()}}}(e)}),E.events.on("keydown",function(e){if(!1===function(e){if(e.which==Z.KEYCODE.TAB){var t;if(0<q().length)t=E.$el.find(".fr-selected-cell").last();else{var l=E.selection.element();"TD"==l.tagName||"TH"==l.tagName?t=A(l):l!=E.el&&(0<A(l).parentsUntil(E.$el,"td").length?t=A(l).parents("td").first():0<A(l).parentsUntil(E.$el,"th").length&&(t=A(l).parents("th").first()))}if(t)return e.preventDefault(),!!(0===E.selection.get().focusOffset&&0<A(E.selection.element()).parentsUntil(E.$el,"ol, ul").length&&(0<A(E.selection.element()).closest("li").prev().length||A(E.selection.element()).is("li")&&0<A(E.selection.element()).prev().length))||(N(),e.shiftKey?0<t.prev().length?X(t.prev()):0<t.closest("tr").length&&0<t.closest("tr").prev().length?X(t.closest("tr").prev().find("td").last()):0<t.closest("tbody").length&&0<t.closest("table").find("thead tr").length&&X(t.closest("table").find("thead tr th").last()):0<t.next().length?X(t.next()):0<t.closest("tr").length&&0<t.closest("tr").next().length?X(t.closest("tr").next().find("td").first()):0<t.closest("thead").length&&0<t.closest("table").find("tbody tr").length?X(t.closest("table").find("tbody tr td").first()):(t.addClass("fr-selected-cell"),u("below"),C(),X(t.closest("tr").next().find("td").first())),E.selection.restore(),!1)}}(e))return!1;var t=q();if(0<t.length){if(0<t.length&&E.keys.ctrlKey(e)&&e.which==Z.KEYCODE.A)return C(),E.popups.isVisible("table.edit")&&E.popups.hide("table.edit"),t=[],!0;if(e.which==Z.KEYCODE.ESC&&E.popups.isVisible("table.edit"))return C(),E.popups.hide("table.edit"),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1;if(1<t.length&&(e.which==Z.KEYCODE.BACKSPACE||e.which==Z.KEYCODE.DELETE)){E.undo.saveStep();for(var l=0;l<t.length;l++)A(t[l]).html("<br>"),l==t.length-1&&A(t[l]).prepend(Z.MARKERS);return E.selection.restore(),E.undo.saveStep(),!1}if(1<t.length&&e.which!=Z.KEYCODE.F10&&!E.keys.isBrowserAction(e))return e.preventDefault(),!1}else if(!(t=[])===function(e){if(e.altKey&&e.which==Z.KEYCODE.SPACE){var t,l=E.selection.element();if("TD"==l.tagName||"TH"==l.tagName?t=l:0<A(l).closest("td").length?t=A(l).closest("td").get(0):0<A(l).closest("th").length&&(t=A(l).closest("th").get(0)),t)return e.preventDefault(),S(t,t),h(),!1}}(e))return!1},!0);var t=[];E.events.on("html.beforeGet",function(){t=q();for(var e=0;e<t.length;e++)t[e].className=(t[e].className||"").replace(/fr-selected-cell/g,"")}),E.events.on("html.afterGet",function(){for(var e=0;e<t.length;e++)t[e].className=(t[e].className?t[e].className.trim()+" ":"")+"fr-selected-cell";t=[]}),i(!0),d(!0)}E.events.on("destroy",U)},insert:function(e,t){var l,a,n="<table "+(E.opts.tableDefaultWidth?'style="width: '+E.opts.tableDefaultWidth+';" ':"")+'class="fr-inserted-table"><tbody>',r=100/t;for(l=0;l<e;l++){for(n+="<tr>",a=0;a<t;a++)n+="<td"+(E.opts.tableDefaultWidth?' style="width: '+r.toFixed(4)+'%;"':"")+">",0===l&&0===a&&(n+=Z.MARKERS),n+="<br></td>";n+="</tr>"}n+="</tbody></table>",E.html.insert(n),E.selection.restore();var s=E.$el.find(".fr-inserted-table");s.removeClass("fr-inserted-table"),E.events.trigger("table.inserted",[s.get(0)])},remove:p,insertRow:u,deleteRow:function(){var e=J();if(0<e.length){var t,l,a,n=x(),r=y(n);if(null==r)return;if(0===r.min_i&&r.max_i==n.length-1)p();else{for(t=r.max_i;t>=r.min_i;t--){for(a=A(e.find("tr").not(e.find("> table tr")).get(t)),l=0;l<n[t].length;l++)if(0===l||n[t][l]!=n[t][l-1]){var s=A(n[t][l]);if(1<parseInt(s.attr("rowspan"),10)){var o=parseInt(s.attr("rowspan"),10)-1;1==o?s.removeAttr("rowspan"):s.attr("rowspan",o)}if(t<n.length-1&&n[t][l]==n[t+1][l]&&(0===t||n[t][l]!=n[t-1][l])){for(var i=n[t][l],f=l;0<f&&n[t][f]==n[t][f-1];)f--;0===f?A(e.find("tr").not(e.find("> table tr")).get(t+1)).prepend(i):A(n[t+1][f-1])[0].parentNode&&A(n[t+1][f-1])[0].insertAdjacentElement("afterend",i)}}var d=a.parent();a.remove(),0===d.find("tr").length&&d.remove(),n=x(e)}v(0,n.length-1,0,n[0].length-1,e),0<r.min_i?E.selection.setAtEnd(n[r.min_i-1][0]):E.selection.setAtEnd(n[0][0]),E.selection.restore(),E.popups.hide("table.edit")}}},insertColumn:function(i){var e=J();if(0<e.length){var f,d=x(),t=y(d);f="before"==i?t.min_j:t.max_j;var l,c=100/d[0].length,p=100/(d[0].length+1);e.find("th, td").each(function(){(l=A(this)).data("old-width",l.outerWidth()/e.outerWidth()*100)}),e.find("tr").not(e.find("> table tr")).each(function(e){for(var t,l=A(this),a=0,n=0;a-1<f;){if(!(t=l.find("> th, > td").get(n))){t=null;break}t==d[e][a]?(a+=parseInt(A(t).attr("colspan"),10)||1,n++):(a+=parseInt(A(d[e][a]).attr("colspan"),10)||1,"after"==i&&(t=0===n?-1:l.find("> th, > td").get(n-1)))}var r,s=A(t);if("after"==i&&f<a-1||"before"==i&&0<f&&d[e][f]==d[e][f-1]){if(0===e||0<e&&d[e][f]!=d[e-1][f]){var o=parseInt(s.attr("colspan"),10)+1;s.attr("colspan",o),s.css("width",(s.data("old-width")*p/c+p).toFixed(4)+"%"),s.removeData("old-width")}}else r=0<l.find("th").length?'<th style="width: '+p.toFixed(4)+'%;"><br></th>':'<td style="width: '+p.toFixed(4)+'%;"><br></td>',-1==t?l.prepend(r):null==t?l.append(r):"before"==i?s.before(r):"after"==i&&s[0].parentNode&&s[0].insertAdjacentHTML("afterend",r)}),e.find("th, td").each(function(){(l=A(this)).data("old-width")&&(l.css("width",(l.data("old-width")*p/c).toFixed(4)+"%"),l.removeData("old-width"))}),E.popups.isVisible("table.edit")&&h()}},deleteColumn:function(){var e=J();if(0<e.length){var t,l,a,n=x(),r=y(n);if(null==r)return;if(0===r.min_j&&r.max_j==n[0].length-1)p();else{var s=0;for(t=0;t<n.length;t++)for(l=0;l<n[0].length;l++)(a=A(n[t][l])).hasClass("fr-selected-cell")||(a.data("old-width",a.outerWidth()/e.outerWidth()*100),(l<r.min_j||l>r.max_j)&&(s+=a.outerWidth()/e.outerWidth()*100));for(s/=n.length,l=r.max_j;l>=r.min_j;l--)for(t=0;t<n.length;t++)if(0===t||n[t][l]!=n[t-1][l])if(a=A(n[t][l]),1<(parseInt(a.attr("colspan"),10)||1)){var o=parseInt(a.attr("colspan"),10)-1;1==o?a.removeAttr("colspan"):a.attr("colspan",o),a.css("width",(100*(a.data("old-width")-V(l,n))/s).toFixed(4)+"%"),a.removeData("old-width")}else{var i=A(a.parent().get(0));a.remove(),0===i.find("> th, > td").length&&(0===i.prev().length||0===i.next().length||i.prev().find("> th[rowspan], > td[rowspan]").length<i.prev().find("> th, > td").length)&&i.remove()}v(0,n.length-1,0,n[0].length-1,e),0<r.min_j?E.selection.setAtEnd(n[r.min_i][r.min_j-1]):E.selection.setAtEnd(n[r.min_i][0]),E.selection.restore(),E.popups.hide("table.edit"),e.find("th, td").each(function(){(a=A(this)).data("old-width")&&(a.css("width",(100*a.data("old-width")/s).toFixed(4)+"%"),a.removeData("old-width"))})}}},mergeCells:function(){if(1<q().length&&(0===E.$el.find("th.fr-selected-cell").length||0===E.$el.find("td.fr-selected-cell").length)){w();var e,t,l=y(x());if(null==l)return;var a=E.$el.find(".fr-selected-cell"),n=A(a[0]),r=n.parent().find(".fr-selected-cell"),s=n.closest("table"),o=n.html(),i=0;for(e=0;e<r.length;e++)i+=A(r[e]).outerWidth();for(n.css("width",Math.min(100,i/s.outerWidth()*100).toFixed(4)+"%"),l.min_j<l.max_j&&n.attr("colspan",l.max_j-l.min_j+1),l.min_i<l.max_i&&n.attr("rowspan",l.max_i-l.min_i+1),e=1;e<a.length;e++)"<br>"!=(t=A(a[e])).html()&&""!==t.html()&&(o+="<br>"+t.html()),t.remove();n.html(o),E.selection.setAtEnd(n.get(0)),E.selection.restore(),E.toolbar.enable(),g(l.min_i,l.max_i,s);var f=s.find("tr:empty");for(e=f.length-1;0<=e;e--)A(f[e]).remove();b(l.min_j,l.max_j,s),h()}},splitCellVertically:function(){if(1==q().length){var e=E.$el.find(".fr-selected-cell"),t=parseInt(e.attr("colspan"),10)||1,l=e.parent().outerWidth(),a=e.outerWidth(),n=e.clone().html("<br>"),r=x(),s=_(e.get(0),r);if(1<t){var o=Math.ceil(t/2);a=P(s.col,s.col+o-1,r)/l*100;var i=P(s.col+o,s.col+t-1,r)/l*100;1<o?e.attr("colspan",o):e.removeAttr("colspan"),1<t-o?n.attr("colspan",t-o):n.removeAttr("colspan"),e.css("width",a.toFixed(4)+"%"),n.css("width",i.toFixed(4)+"%")}else{var f;for(f=0;f<r.length;f++)if(0===f||r[f][s.col]!=r[f-1][s.col]){var d=A(r[f][s.col]);if(!d.is(e)){var c=(parseInt(d.attr("colspan"),10)||1)+1;d.attr("colspan",c)}}a=a/l*100/2,e.css("width",a.toFixed(4)+"%"),n.css("width",a.toFixed(4)+"%")}e[0].parentNode&&e[0].insertAdjacentElement("afterend",n[0]),C(),E.popups.hide("table.edit")}},splitCellHorizontally:function(){if(1==q().length){var e=E.$el.find(".fr-selected-cell"),t=e.parent(),l=e.closest("table"),a=parseInt(e.attr("rowspan"),10),n=x(),r=_(e.get(0),n),s=e.clone().html("<br>");if(1<a){var o=Math.ceil(a/2);1<o?e.attr("rowspan",o):e.removeAttr("rowspan"),1<a-o?s.attr("rowspan",a-o):s.removeAttr("rowspan");for(var i=r.row+o,f=0===r.col?r.col:r.col-1;0<=f&&(n[i][f]==n[i][f-1]||0<i&&n[i][f]==n[i-1][f]);)f--;-1==f?A(l.find("tr").not(l.find("> table tr")).get(i)).prepend(s):A(n[i][f])[0].parentNode&&A(n[i][f])[0].insertAdjacentElement("afterend",s[0])}else{var d,c=A(document.createElement("tr")).append(s);for(d=0;d<n[0].length;d++)if(0===d||n[r.row][d]!=n[r.row][d-1]){var p=A(n[r.row][d]);p.is(e)||p.attr("rowspan",(parseInt(p.attr("rowspan"),10)||1)+1)}t[0].parentNode&&t[0].insertAdjacentElement("afterend",c[0])}C(),E.popups.hide("table.edit")}},addHeader:function(){var e=J();if(0<e.length&&0===e.find("th").length){var t,l="<thead><tr>",a=0;for(e.find("tr").first().find("> td").each(function(){var e=A(this);a+=parseInt(e.attr("colspan"),10)||1}),t=0;t<a;t++)l+="<th><br></th>";l+="</tr></thead>",e.prepend(l),h()}},removeHeader:function(){var e=J(),t=e.find("thead");if(0<t.length)if(0===e.find("tbody tr").length)p();else if(t.remove(),0<q().length)h();else{E.popups.hide("table.edit");var l=e.find("tbody tr").first().find("td").first().get(0);l&&(E.selection.setAtEnd(l),E.selection.restore())}},setBackground:t,showInsertPopup:function(){var e=E.$tb.find('.fr-command[data-cmd="insertTable"]'),t=E.popups.get("table.insert");if(!(t=t||i()).hasClass("fr-active")){E.popups.refresh("table.insert"),E.popups.setContainer("table.insert",E.$tb);var l=E.button.getPosition(e),a=l.left,n=l.top;E.popups.show("table.insert",a,n,e.outerHeight())}},showEditPopup:h,showColorsPopup:function n(){var e,t,l,a,r=x();if(r){var s=E.popups.get("table.colors");s=s||function(){var e="";0<E.opts.tableColorsButtons.length&&(e='<div class="fr-buttons fr-tabs">'+E.button.buildList(E.opts.tableColorsButtons)+"</div>");var t="";E.opts.colorsHEXInput&&(t='<div class="fr-color-hex-layer fr-table-colors-hex-layer fr-active fr-layer" id="fr-table-colors-hex-layer-'+E.id+'"><div class="fr-input-line"><input maxlength="7" id="fr-table-colors-hex-layer-text-'+E.id+'" type="text" placeholder="'+E.language.translate("HEX Color")+'" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="tableCellBackgroundCustomColor" tabIndex="2" role="button">'+E.language.translate("OK")+"</button></div></div>");var h,l={buttons:e,colors:function(){for(var e='<div class="fr-color-set fr-table-colors">',t=0;t<E.opts.tableColors.length;t++)0!==t&&t%E.opts.tableColorsStep==0&&(e+="<br>"),"REMOVE"!=E.opts.tableColors[t]?e+='<span class="fr-command" style="background: '+E.opts.tableColors[t]+';" tabIndex="-1" role="button" data-cmd="tableCellBackgroundColor" data-param1="'+E.opts.tableColors[t]+'"><span class="fr-sr-only">'+E.language.translate("Color")+" "+E.opts.tableColors[t]+"&nbsp;&nbsp;&nbsp;</span></span>":e+='<span class="fr-command" data-cmd="tableCellBackgroundColor" tabIndex="-1" role="button" data-param1="REMOVE" title="'+E.language.translate("Clear Formatting")+'">'+E.icon.create("tableColorRemove")+'<span class="fr-sr-only">'+E.language.translate("Clear Formatting")+"</span></span>";return e+"</div>"}(),custom_color:t},a=E.popups.create("table.colors",l);return E.events.$on(E.$wp,"scroll.table-colors",function(){E.popups.isVisible("table.colors")&&n()}),h=a,E.events.on("popup.tab",function(e){var t=A(e.currentTarget);if(!E.popups.isVisible("table.colors")||!t.is("span"))return!0;var l=e.which,a=!0;if(Z.KEYCODE.TAB==l){var n=h.find(".fr-buttons");a=!E.accessibility.focusToolbar(n,!!e.shiftKey)}else if(Z.KEYCODE.ARROW_UP==l||Z.KEYCODE.ARROW_DOWN==l||Z.KEYCODE.ARROW_LEFT==l||Z.KEYCODE.ARROW_RIGHT==l){var r=t.parent().find("span.fr-command"),s=r.index(t),o=E.opts.colorsStep,i=Math.floor(r.length/o),f=s%o,d=Math.floor(s/o)*o+f,c=i*o;Z.KEYCODE.ARROW_UP==l?d=((d-o)%c+c)%c:Z.KEYCODE.ARROW_DOWN==l?d=(d+o)%c:Z.KEYCODE.ARROW_LEFT==l?d=((d-1)%c+c)%c:Z.KEYCODE.ARROW_RIGHT==l&&(d=(d+1)%c);var p=A(r.get(d));E.events.disableBlur(),p.focus(),a=!1}else Z.KEYCODE.ENTER==l&&(E.button.exec(t),a=!1);return!1===a&&(e.preventDefault(),e.stopPropagation()),a},!0),a}(),E.popups.setContainer("table.colors",E.$sc);var o=M(r),i=(o.left+o.right)/2,f=o.bottom;e=E.popups.get("table.colors"),t=E.$el.find(".fr-selected-cell").first(),l=E.helpers.RGBToHex(t.css("background-color")),a=e.find(".fr-table-colors-hex-layer input"),e.find(".fr-selected-color").removeClass("fr-selected-color fr-active-item"),e.find('span[data-param1="'+l+'"]').addClass("fr-selected-color fr-active-item"),a.val(l).trigger("change"),E.popups.show("table.colors",i,f,o.bottom-o.top,!0)}},back:function(){0<q().length?h():(E.popups.hide("table.insert"),E.toolbar.showInline())},verticalAlign:function(e){E.$el.find(".fr-selected-cell").css("vertical-align",e)},horizontalAlign:function(e){E.$el.find(".fr-selected-cell").css("text-align",e)},applyStyle:function(e,t,l,a){if(0<t.length){if(!l){var n=Object.keys(a);n.splice(n.indexOf(e),1),t.removeClass(n.join(" "))}t.toggleClass(e)}},selectedTable:J,selectedCells:q,customColor:function(){var e=E.popups.get("table.colors").find(".fr-table-colors-hex-layer input");e.length&&t(e.val())},selectCells:S}},Z.DefineIcon("insertTable",{NAME:"table",SVG_KEY:"insertTable"}),Z.RegisterCommand("insertTable",{title:"Insert Table",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("table.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("table.insert")):this.table.showInsertPopup()},plugin:"table"}),Z.RegisterCommand("tableInsert",{callback:function(e,t,l){this.table.insert(t,l),this.popups.hide("table.insert")}}),Z.DefineIcon("tableHeader",{NAME:"header",FA5NAME:"heading",SVG_KEY:"tableHeader"}),Z.RegisterCommand("tableHeader",{title:"Table Header",focus:!1,toggle:!0,callback:function(){this.popups.get("table.edit").find('.fr-command[data-cmd="tableHeader"]').hasClass("fr-active")?this.table.removeHeader():this.table.addHeader()},refresh:function(e){var t=this.table.selectedTable();0<t.length&&(0===t.find("th").length?e.removeClass("fr-active").attr("aria-pressed",!1):e.addClass("fr-active").attr("aria-pressed",!0))}}),Z.DefineIcon("tableRows",{NAME:"bars",SVG_KEY:"row"}),Z.RegisterCommand("tableRows",{type:"dropdown",focus:!1,title:"Row",options:{above:"Insert row above",below:"Insert row below",delete:"Delete row"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=Z.COMMANDS.tableRows.options;for(var l in t)t.hasOwnProperty(l)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableRows" data-param1="'+l+'" title="'+this.language.translate(t[l])+'">'+this.language.translate(t[l])+"</a></li>");return e+"</ul>"},callback:function(e,t){"above"==t||"below"==t?this.table.insertRow(t):this.table.deleteRow()}}),Z.DefineIcon("tableColumns",{NAME:"bars fa-rotate-90",SVG_KEY:"columns"}),Z.RegisterCommand("tableColumns",{type:"dropdown",focus:!1,title:"Column",options:{before:"Insert column before",after:"Insert column after",delete:"Delete column"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=Z.COMMANDS.tableColumns.options;for(var l in t)t.hasOwnProperty(l)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableColumns" data-param1="'+l+'" title="'+this.language.translate(t[l])+'">'+this.language.translate(t[l])+"</a></li>");return e+"</ul>"},callback:function(e,t){"before"==t||"after"==t?this.table.insertColumn(t):this.table.deleteColumn()}}),Z.DefineIcon("tableCells",{NAME:"square-o",FA5NAME:"square",SVG_KEY:"cellOptions"}),Z.RegisterCommand("tableCells",{type:"dropdown",focus:!1,title:"Cell",options:{merge:"Merge cells","vertical-split":"Vertical split","horizontal-split":"Horizontal split"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=Z.COMMANDS.tableCells.options;for(var l in t)t.hasOwnProperty(l)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCells" data-param1="'+l+'" title="'+this.language.translate(t[l])+'">'+this.language.translate(t[l])+"</a></li>");return e+"</ul>"},callback:function(e,t){"merge"==t?this.table.mergeCells():"vertical-split"==t?this.table.splitCellVertically():this.table.splitCellHorizontally()},refreshOnShow:function(e,t){1<this.$el.find(".fr-selected-cell").length?(t.find('a[data-param1="vertical-split"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="horizontal-split"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="merge"]').removeClass("fr-disabled").attr("aria-disabled",!1)):(t.find('a[data-param1="merge"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="vertical-split"]').removeClass("fr-disabled").attr("aria-disabled",!1),t.find('a[data-param1="horizontal-split"]').removeClass("fr-disabled").attr("aria-disabled",!1))}}),Z.DefineIcon("tableRemove",{NAME:"trash",SVG_KEY:"removeTable"}),Z.RegisterCommand("tableRemove",{title:"Remove Table",focus:!1,callback:function(){this.table.remove()}}),Z.DefineIcon("tableStyle",{NAME:"paint-brush",SVG_KEY:"tableStyle"}),Z.RegisterCommand("tableStyle",{title:"Table Style",type:"dropdown",focus:!1,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.tableStyles;for(var l in t)t.hasOwnProperty(l)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableStyle" data-param1="'+l+'" title="'+this.language.translate(t[l])+'">'+this.language.translate(t[l])+"</a></li>");return e+"</ul>"},callback:function(e,t){this.table.applyStyle(t,this.$el.find(".fr-selected-cell").closest("table"),this.opts.tableMultipleStyles,this.opts.tableStyles)},refreshOnShow:function(e,t){var l=this.$,a=this.$el.find(".fr-selected-cell").closest("table");a&&t.find(".fr-command").each(function(){var e=l(this).data("param1"),t=a.hasClass(e);l(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),Z.DefineIcon("tableCellBackground",{NAME:"tint",SVG_KEY:"cellBackground"}),Z.RegisterCommand("tableCellBackground",{title:"Cell Background",focus:!1,popup:!0,callback:function(){this.table.showColorsPopup()}}),Z.RegisterCommand("tableCellBackgroundColor",{undo:!0,focus:!1,callback:function(e,t){this.table.setBackground(t)}}),Z.DefineIcon("tableBack",{NAME:"arrow-left",SVG_KEY:"back"}),Z.RegisterCommand("tableBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.table.back()},refresh:function(e){0!==this.table.selectedCells().length||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),Z.DefineIcon("tableCellVerticalAlign",{NAME:"arrows-v",FA5NAME:"arrows-alt-v",SVG_KEY:"verticalAlignMiddle"}),Z.RegisterCommand("tableCellVerticalAlign",{type:"dropdown",focus:!1,title:"Vertical Align",options:{Top:"Align Top",Middle:"Align Middle",Bottom:"Align Bottom"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=Z.COMMANDS.tableCellVerticalAlign.options;for(var l in t)t.hasOwnProperty(l)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellVerticalAlign" data-param1="'+l.toLowerCase()+'" title="'+this.language.translate(t[l])+'">'+this.language.translate(l)+"</a></li>");return e+"</ul>"},callback:function(e,t){this.table.verticalAlign(t)},refreshOnShow:function(e,t){t.find('.fr-command[data-param1="'+this.$el.find(".fr-selected-cell").css("vertical-align")+'"]').addClass("fr-active").attr("aria-selected",!0)}}),Z.DefineIcon("tableCellHorizontalAlign",{NAME:"align-left",SVG_KEY:"alignLeft"}),Z.DefineIcon("align-left",{NAME:"align-left",SVG_KEY:"alignLeft"}),Z.DefineIcon("align-right",{NAME:"align-right",SVG_KEY:"alignRight"}),Z.DefineIcon("align-center",{NAME:"align-center",SVG_KEY:"alignCenter"}),Z.DefineIcon("align-justify",{NAME:"align-justify",SVG_KEY:"alignJustify"}),Z.RegisterCommand("tableCellHorizontalAlign",{type:"dropdown",focus:!1,title:"Horizontal Align",options:{left:"Align Left",center:"Align Center",right:"Align Right",justify:"Align Justify"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=Z.COMMANDS.tableCellHorizontalAlign.options;for(var l in t)t.hasOwnProperty(l)&&(e+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="tableCellHorizontalAlign" data-param1="'+l+'" title="'+this.language.translate(t[l])+'">'+this.icon.create("align-"+l)+'<span class="fr-sr-only">'+this.language.translate(t[l])+"</span></a></li>");return e+"</ul>"},callback:function(e,t){this.table.horizontalAlign(t)},refresh:function(e){var t=this.table.selectedCells(),l=this.$;t.length&&e.find("> *").first().replaceWith(this.icon.create("align-"+this.helpers.getAlignment(l(t[0]))))},refreshOnShow:function(e,t){t.find('.fr-command[data-param1="'+this.helpers.getAlignment(this.$el.find(".fr-selected-cell").first())+'"]').addClass("fr-active").attr("aria-selected",!0)}}),Z.DefineIcon("tableCellStyle",{NAME:"magic",SVG_KEY:"cellStyle"}),Z.RegisterCommand("tableCellStyle",{title:"Cell Style",type:"dropdown",focus:!1,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.tableCellStyles;for(var l in t)t.hasOwnProperty(l)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellStyle" data-param1="'+l+'" title="'+this.language.translate(t[l])+'">'+this.language.translate(t[l])+"</a></li>");return e+"</ul>"},callback:function(e,t){this.table.applyStyle(t,this.$el.find(".fr-selected-cell"),this.opts.tableCellMultipleStyles,this.opts.tableCellStyles)},refreshOnShow:function(e,t){var l=this.$,a=this.$el.find(".fr-selected-cell").first();a&&t.find(".fr-command").each(function(){var e=l(this).data("param1"),t=a.hasClass(e);l(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),Z.RegisterCommand("tableCellBackgroundCustomColor",{title:"OK",undo:!0,callback:function(){this.table.customColor()}}),Z.DefineIcon("tableColorRemove",{NAME:"eraser",SVG_KEY:"remove"})});