!function(f,u,m,i){var n="ontouchstart"in m,g=function(){var t=m.createElement("div"),e=m.documentElement;if(!("pointerEvents"in t.style))return!1;t.style.pointerEvents="auto",t.style.pointerEvents="x",e.appendChild(t);var s=u.getComputedStyle&&"auto"===u.getComputedStyle(t,"").pointerEvents;return e.removeChild(t),!!s}(),s={contentCallback:function(t){return t.content?t.content:t.id},listNodeName:"ol",itemNodeName:"li",handleNodeName:"div",contentNodeName:"div",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",contentClass:"dd-content",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",noChildrenClass:"dd-nochildren",emptyClass:"dd-empty",expandBtnHTML:'<button class="dd-expand" data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button class="dd-collapse" data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20,fixedDepth:!1,fixed:!1,includeContent:!1,scroll:!1,scrollSensitivity:1,scrollSpeed:5,scrollTriggers:{top:40,left:40,right:-40,bottom:-40},effect:{animation:"none",time:"slow"},callback:function(t,e,s){},onDragStart:function(t,e,s){},beforeDragStop:function(t,e,s){},listRenderer:function(t,e){var s="<"+e.listNodeName+' class="'+e.listClass+'">';return s+=t,s+="</"+e.listNodeName+">"},itemRenderer:function(t,e,s,i,o){var n=f.map(t,function(t,e){return" "+e+'="'+t+'"'}).join(" "),l="<"+i.itemNodeName+n+">";return l+="<"+i.handleNodeName+' class="'+i.handleClass+'">',l+="<"+i.contentNodeName+' class="'+i.contentClass+'">',l+=e,l+="</"+i.contentNodeName+">",l+="</"+i.handleNodeName+">",l+=s,l+="</"+i.itemNodeName+">"}};function l(t,e){this.w=f(m),this.el=f(t),(e=e||s).rootClass!==i&&"dd"!==e.rootClass&&(e.listClass=e.listClass?e.listClass:e.rootClass+"-list",e.itemClass=e.itemClass?e.itemClass:e.rootClass+"-item",e.dragClass=e.dragClass?e.dragClass:e.rootClass+"-dragel",e.handleClass=e.handleClass?e.handleClass:e.rootClass+"-handle",e.collapsedClass=e.collapsedClass?e.collapsedClass:e.rootClass+"-collapsed",e.placeClass=e.placeClass?e.placeClass:e.rootClass+"-placeholder",e.noDragClass=e.noDragClass?e.noDragClass:e.rootClass+"-nodrag",e.noChildrenClass=e.noChildrenClass?e.noChildrenClass:e.rootClass+"-nochildren",e.emptyClass=e.emptyClass?e.emptyClass:e.rootClass+"-empty"),this.options=f.extend({},s,e),this.options.json!==i&&this._build(),this.init()}l.prototype={init:function(){var o=this;o.reset(),o.el.data("nestable-group",this.options.group),o.placeEl=f('<div class="'+o.options.placeClass+'"/>');var t=this.el.find(o.options.itemNodeName);f.each(t,function(t,e){var s=f(e),i=s.parent();o.setParent(s),i.hasClass(o.options.collapsedClass)&&o.collapseItem(i.parent())}),t.length||this.appendEmptyElement(this.el),o.el.on("click","button",function(t){if(!o.dragEl){var e=f(t.currentTarget),s=e.data("action"),i=e.parents(o.options.itemNodeName).eq(0);"collapse"===s&&o.collapseItem(i),"expand"===s&&o.expandItem(i)}});function e(t){var e=f(t.target);if(!e.hasClass(o.options.handleClass)){if(e.closest("."+o.options.noDragClass).length)return;e=e.closest("."+o.options.handleClass)}e.length&&!o.dragEl&&(o.isTouch=/^touch/.test(t.type),o.isTouch&&1!==t.touches.length||(t.preventDefault(),o.dragStart(t.touches?t.touches[0]:t)))}function s(t){o.dragEl&&(t.preventDefault(),o.dragMove(t.touches?t.touches[0]:t))}function i(t){o.dragEl&&(t.preventDefault(),o.dragStop(t.touches?t.changedTouches[0]:t))}n&&(o.el[0].addEventListener("touchstart",e,!1),u.addEventListener("touchmove",s,!1),u.addEventListener("touchend",i,!1),u.addEventListener("touchcancel",i,!1)),o.el.on("mousedown",e),o.w.on("mousemove",s),o.w.on("mouseup",i);o.el.bind("destroy-nestable",function(){n&&(o.el[0].removeEventListener("touchstart",e,!1),u.removeEventListener("touchmove",s,!1),u.removeEventListener("touchend",i,!1),u.removeEventListener("touchcancel",i,!1)),o.el.off("mousedown",e),o.w.off("mousemove",s),o.w.off("mouseup",i),o.el.off("click"),o.el.unbind("destroy-nestable"),o.el.data("nestable",null)})},destroy:function(){this.el.trigger("destroy-nestable")},add:function(t){var e="."+this.options.listClass,s=f(this.el).children(e);t.parent_id!==i&&(s=s.find('[data-id="'+t.parent_id+'"]'),delete t.parent_id,0===s.children(e).length&&(s=s.append(this.options.listRenderer("",this.options))),s=s.find(e+":first"),this.setParent(s.parent())),s.append(this._buildItem(t,this.options))},replace:function(t){var e=this._buildItem(t,this.options);this._getItemById(t.id).replaceWith(e)},removeItem:function(t){var e=this.options,s=this.el;(t=t||this).remove();var i="."+e.listClass+" ."+e.listClass+":not(:has(*))";f(s).find(i).remove();f(s).find('[data-action="expand"], [data-action="collapse"]').each(function(){0===f(this).siblings("."+e.listClass).length&&f(this).remove()})},remove:function(t,e){var s=this.options,i=this,o=this._getItemById(t),n=s.effect.animation||"fade",l=s.effect.time||"slow";"fade"===n?o.fadeOut(l,function(){i.removeItem(o)}):this.removeItem(o),e&&e()},removeAll:function(t){var e=this,s=this.options,i=e.el.find(s.listNodeName).first(),o=i.children(s.itemNodeName),n=s.effect.animation||"fade",l=s.effect.time||"slow";function a(){o.each(function(){e.removeItem(f(this))}),i.show(),t&&t()}"fade"===n?i.fadeOut(l,a):a()},_getItemById:function(t){return f(this.el).children("."+this.options.listClass).find('[data-id="'+t+'"]')},_build:function(){var t=this.options.json;"string"==typeof t&&(t=JSON.parse(t)),f(this.el).html(this._buildList(t,this.options))},_buildList:function(t,s){if(!t)return"";var i="",o=this;return f.each(t,function(t,e){i+=o._buildItem(e,s)}),s.listRenderer(i,s)},_buildItem:function(t,e){var s=function(t){delete(t=f.extend({},t)).children,delete t.classes,delete t.content;var s={};return f.each(t,function(t,e){"object"==typeof e&&(e=JSON.stringify(e)),s["data-"+t]=function(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t+"".replace(/[&<>"']/g,function(t){return e[t]})}(e)}),s}(t);s.class=function(t,e){var s=t.classes||{};"string"==typeof s&&(s=[s]);var i=function(t){var e={};for(var s in t)e[t[s]]=t[s];return e}(s);return i[e.itemClass]=e.itemClass,f.map(i,function(t){return t}).join(" ")}(t,e);var i=e.contentCallback(t),o=this._buildList(t.children,e),n=f(e.itemRenderer(s,i,o,e,t));return this.setParent(n),n[0].outerHTML},serialize:function(){var n=this,l=function(t){var o=[];return t.children(n.options.itemNodeName).each(function(){var t=f(this),e=f.extend({},t.data()),s=t.children(n.options.listNodeName);if(n.options.includeContent){var i=t.find("."+n.options.contentClass).html();i&&(e.content=i)}s.length&&(e.children=l(s)),o.push(e)}),o};return l(n.el.find(n.options.listNodeName).first())},asNestedSet:function(){var a=this.options,r=[],t=1;return this.el.find(a.listNodeName).first().children(a.itemNodeName).each(function(){t=function t(e,s,i){var o,n,l=i+1;0<f(e).children(a.listNodeName).children(a.itemNodeName).length&&(s++,f(e).children(a.listNodeName).children(a.itemNodeName).each(function(){l=t(f(this),s,l)}),s--);o=f(e).attr("data-id");d(o)&&(o=parseInt(o));n=f(e).parent(a.listNodeName).parent(a.itemNodeName).attr("data-id")||"";d(n)&&(n=parseInt(n));o&&r.push({id:o,parent_id:n,depth:s,lft:i,rgt:l});i=l+1;return i}(this,0,t)}),r=r.sort(function(t,e){return t.lft-e.lft});function d(t){return f.isNumeric(t)&&Math.floor(t)==t}},returnOptions:function(){return this.options},serialise:function(){return this.serialize()},toHierarchy:function(t){var o=f.extend({},this.options,t),e=[];return f(this.element).children(o.items).each(function(){var t=function e(t){var s=(f(t).attr(o.attribute||"id")||"").match(o.expression||/(.+)[-=_](.+)/);if(s){var i={id:s[2]};return 0<f(t).children(o.listType).children(o.items).length&&(i.children=[],f(t).children(o.listType).children(o.items).each(function(){var t=e(this);i.children.push(t)})),i}}(this);e.push(t)}),e},toArray:function(){var r=f.extend({},this.options,this),d=r.startDepthCount||0,h=[],t=2;return this.el.find(this.options.listNodeName).first().children(this.options.itemNodeName).each(function(){t=function t(e,s,i){var o,n,l=i+1;0<e.children(r.options.listNodeName).children(r.options.itemNodeName).length&&(s++,e.children(r.options.listNodeName).children(r.options.itemNodeName).each(function(){l=t(f(this),s,l)}),s--);o=e.data().id;if(s===d+1)n=r.rootID;else{var a=e.parent(r.options.listNodeName).parent(r.options.itemNodeName).data();n=a.id}o&&h.push({id:o,parent_id:n,depth:s,left:i,right:l});i=l+1;return i}(f(this),d+1,t)}),h=h.sort(function(t,e){return t.left-e.left})},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.isTouch=!1,this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},expandItem:function(t){t.removeClass(this.options.collapsedClass)},collapseItem:function(t){t.children(this.options.listNodeName).length&&t.addClass(this.options.collapsedClass)},expandAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.expandItem(f(this))})},collapseAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.collapseItem(f(this))})},setParent:function(t){t.is(this.options.itemNodeName)&&t.children(this.options.listNodeName).length&&(t.children("[data-action]").remove(),t.prepend(f(this.options.expandBtnHTML)),t.prepend(f(this.options.collapseBtnHTML)))},unsetParent:function(t){t.removeClass(this.options.collapsedClass),t.children("[data-action]").remove(),t.children(this.options.listNodeName).remove()},dragStart:function(t){var e=this.mouse,s=f(t.target).closest(this.options.itemNodeName),i={top:t.pageY,left:t.pageX},o=this.options.onDragStart.call(this,this.el,s,i);if(void 0===o||!1!==o){this.placeEl.css("height",s.height()),e.offsetX=t.pageX-s.offset().left,e.offsetY=t.pageY-s.offset().top,e.startX=e.lastX=t.pageX,e.startY=e.lastY=t.pageY,this.dragRootEl=this.el,this.dragEl=f(m.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",s.outerWidth()),this.setIndexOfItem(s),s.after(this.placeEl),s[0].parentNode.removeChild(s[0]),s.appendTo(this.dragEl),f(m.body).append(this.dragEl),this.dragEl.css({left:t.pageX-e.offsetX,top:t.pageY-e.offsetY});var n,l,a=this.dragEl.find(this.options.itemNodeName);for(n=0;n<a.length;n++)(l=f(a[n]).parents(this.options.listNodeName).length)>this.dragDepth&&(this.dragDepth=l)}},createSubLevel:function(t,e){var s=f("<"+this.options.listNodeName+"/>").addClass(this.options.listClass);return e&&s.append(e),t.append(s),this.setParent(t),s},setIndexOfItem:function(t,e){(e=e||[]).unshift(t.index()),f(t[0].parentNode)[0]!==this.dragRootEl[0]?this.setIndexOfItem(f(t[0].parentNode),e):this.dragEl.data("indexOfItem",e)},restoreItemAtIndex:function(t,e){var s,i,o=this.el,n=e.length-1;for(var l=0;l<e.length;l++){if(n===parseInt(l))return s=o,i=t,void(0===e[n]?f(s).prepend(i.clone(!0)):f(s.children[e[n]-1]).after(i.clone(!0)));var a=o[0]?o[0]:o,r=a.children[e[l]];o=r||this.createSubLevel(f(a))}},dragStop:function(t){var e={top:t.pageY,left:t.pageX},s=this.dragEl.data("indexOfItem"),i=this.dragEl.children(this.options.itemNodeName).first();i[0].parentNode.removeChild(i[0]),this.dragEl.remove();var o=this.options.beforeDragStop.call(this,this.el,i,this.placeEl.parent());if(void 0!==o&&!1===o){var n=this.placeEl.parent();return this.placeEl.remove(),n.children().length||this.unsetParent(n.parent()),this.restoreItemAtIndex(i,s),void this.reset()}this.placeEl.replaceWith(i),this.hasNewRoot?(!0===this.options.fixed?this.restoreItemAtIndex(i,s):this.el.trigger("lostItem"),this.dragRootEl.trigger("gainedItem")):this.dragRootEl.trigger("change"),this.options.callback.call(this,this.dragRootEl,i,e),this.reset()},dragMove:function(t){var e,s,i,o=this.options,n=this.mouse;this.dragEl.css({left:t.pageX-n.offsetX,top:t.pageY-n.offsetY}),n.lastX=n.nowX,n.lastY=n.nowY,n.nowX=t.pageX,n.nowY=t.pageY,n.distX=n.nowX-n.lastX,n.distY=n.nowY-n.lastY,n.lastDirX=n.dirX,n.lastDirY=n.dirY,n.dirX=0===n.distX?0:0<n.distX?1:-1,n.dirY=0===n.distY?0:0<n.distY?1:-1;var l=Math.abs(n.distX)>Math.abs(n.distY)?1:0;if(!n.moving)return n.dirAx=l,void(n.moving=!0);if(o.scroll)if(void 0!==u.jQuery.fn.scrollParent){var a=!1,r=this.el.scrollParent()[0];r!==m&&"HTML"!==r.tagName?(o.scrollTriggers.bottom+r.offsetHeight-t.pageY<o.scrollSensitivity?r.scrollTop=a=r.scrollTop+o.scrollSpeed:t.pageY-o.scrollTriggers.top<o.scrollSensitivity&&(r.scrollTop=a=r.scrollTop-o.scrollSpeed),o.scrollTriggers.right+r.offsetWidth-t.pageX<o.scrollSensitivity?r.scrollLeft=a=r.scrollLeft+o.scrollSpeed:t.pageX-o.scrollTriggers.left<o.scrollSensitivity&&(r.scrollLeft=a=r.scrollLeft-o.scrollSpeed)):(t.pageY-f(m).scrollTop()<o.scrollSensitivity?a=f(m).scrollTop(f(m).scrollTop()-o.scrollSpeed):f(u).height()-(t.pageY-f(m).scrollTop())<o.scrollSensitivity&&(a=f(m).scrollTop(f(m).scrollTop()+o.scrollSpeed)),t.pageX-f(m).scrollLeft()<o.scrollSensitivity?a=f(m).scrollLeft(f(m).scrollLeft()-o.scrollSpeed):f(u).width()-(t.pageX-f(m).scrollLeft())<o.scrollSensitivity&&(a=f(m).scrollLeft(f(m).scrollLeft()+o.scrollSpeed)))}else console.warn("To use scrolling you need to have scrollParent() function, check documentation for more information");this.scrollTimer&&clearTimeout(this.scrollTimer),o.scroll&&a&&(this.scrollTimer=setTimeout(function(){f(u).trigger(t)},10)),n.dirAx!==l?(n.distAxX=0,n.distAxY=0):(n.distAxX+=Math.abs(n.distX),0!==n.dirX&&n.dirX!==n.lastDirX&&(n.distAxX=0),n.distAxY+=Math.abs(n.distY),0!==n.dirY&&n.dirY!==n.lastDirY&&(n.distAxY=0)),n.dirAx=l,n.dirAx&&n.distAxX>=o.threshold&&(n.distAxX=0,i=this.placeEl.prev(o.itemNodeName),0<n.distX&&i.length&&!i.hasClass(o.collapsedClass)&&!i.hasClass(o.noChildrenClass)&&(e=i.find(o.listNodeName).last(),this.placeEl.parents(o.listNodeName).length+this.dragDepth<=o.maxDepth&&(e.length?(e=i.children(o.listNodeName).last()).append(this.placeEl):this.createSubLevel(i,this.placeEl))),n.distX<0&&(this.placeEl.next(o.itemNodeName).length||(s=this.placeEl.parent(),this.placeEl.closest(o.itemNodeName).after(this.placeEl),s.children().length||this.unsetParent(s.parent()))));var d=!1;if(g||(this.dragEl[0].style.visibility="hidden"),this.pointEl=f(m.elementFromPoint(t.pageX-m.body.scrollLeft,t.pageY-(u.pageYOffset||m.documentElement.scrollTop))),g||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(o.handleClass)&&(this.pointEl=this.pointEl.closest(o.itemNodeName)),this.pointEl.hasClass(o.emptyClass))d=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(o.itemClass))return;var h=this.pointEl.closest("."+o.rootClass),c=this.dragRootEl.data("nestable-id")!==h.data("nestable-id");if(!n.dirAx||c||d){if(c&&o.group!==h.data("nestable-group"))return;if(this.options.fixedDepth&&this.dragDepth+1!==this.pointEl.parents(o.listNodeName).length)return;if(this.dragDepth-1+this.pointEl.parents(o.listNodeName).length>o.maxDepth)return;var p=t.pageY<this.pointEl.offset().top+this.pointEl.height()/2;s=this.placeEl.parent(),d?((e=f(m.createElement(o.listNodeName)).addClass(o.listClass)).append(this.placeEl),this.pointEl.replaceWith(e)):p?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),s.children().length||this.unsetParent(s.parent()),this.dragRootEl.find(o.itemNodeName).length||this.appendEmptyElement(this.dragRootEl),this.dragRootEl=h,c&&(this.hasNewRoot=this.el[0]!==this.dragRootEl[0])}},appendEmptyElement:function(t){t.append('<div class="'+this.options.emptyClass+'"/>')}},f.fn.nestable=function(i){var o=this,n=arguments;return"Nestable"in u||(u.Nestable={},Nestable.counter=0),this.each(function(){var t=f(this).data("nestable");if(t){if("string"==typeof i&&"function"==typeof t[i])if(1<n.length){for(var e=[],s=1;s<n.length;s++)e.push(n[s]);o=t[i].apply(t,e)}else o=t[i]()}else Nestable.counter++,f(this).data("nestable",new l(this,i)),f(this).data("nestable-id",Nestable.counter)}),o||this}}(window.jQuery||window.Zepto,window,document);