!function($){var CompleteData={};$.fn.tagComplete=function(t){var s=$.extend(!0,{hide:!1,keyLimit:1,tokenizer:",",freeInput:!0,freeEdit:!0,setView:{},autocomplete:{data:[],ajaxOpts:{method:"GET",dataType:"json",data:{}},params:function(t){return{q:t,lol:23}},proccessData:function(t){return t}},onAdd:function(t){return!0},onDelete:function(t){return!0}},t);return CompleteData=s.setView,backspaceKey=8,enterKey=13,this.destroy=function(){var t=$(this).data("tagcomplete-id");if(!t)return!1;var a=document.getElementById(t);$(a).remove(),$(this).removeData(),$(this).val(""),refreshDom=(new Date).getTime()+Math.random(),$(this).attr("data-tagcomplete-refresh",refreshDom),$(this).addClass("tag-complete-dead").removeClass("hide")},this.reInit=function(t){return this.destroy(),t&&(s=$.extend(!0,s,t)),$.fn.tagComplete.call(this,s)},this.each(function(t,a){var e=this;ajaxPool=[],userInput=e=$(a);var n=userInput.val()||"";userInput.hide();var o=(t+=1)+(new Date).getTime()+Math.floor(Math.random());if(tagCompleteMain=$("<div id='"+o+"' class='tag_complete_main'><div class='tag_complete'><input type='text' class='tag_input form-control' /><div class='row'><div class='col-lg-12'><ul class='tags_container'></ul></div></div></div><ul class='autocomplete hide'></ul></div>"),1==s.hide&&tagCompleteMain.hide(),userInput.attr("data-tagcomplete-id",o),tagCompleteMain.insertAfter(userInput),tagComplete=tagCompleteMain.find(".tag_complete"),tagInput=tagComplete.find(".tag_input"),tagsContainer=tagComplete.find(".tags_container"),autoComplete=tagCompleteMain.find(".autocomplete"),instanceData={userInput:userInput,tagCompleteMain:tagCompleteMain,tagComplete:tagComplete,tagsContainer:tagsContainer,tagInput:tagInput,autoComplete:autoComplete,options:s,ajaxPool:ajaxPool},this.instance=e.instance=instanceData,0<n.length){var l=n.split(s.tokenizer);$.each(l,function(t,a){$.fn.addTag(a,a,e.instance)})}tagComplete.on("click",instanceData,function(t){t.data.tagInput.focus()}),tagInput.on("focus",instanceData,function(t){t.data.tagComplete.addClass("is_focused")}).on("blur",instanceData,function(t){t.data.tagComplete.removeClass("is_focused")}),autoComplete.on("click","li",instanceData,function(t){inst=t.data;var a=$(this).data("id");$.fn.addTag(a,$(this).text(),inst),$.fn.refreshUserInput(inst.userInput,inst.tagsContainer,inst.options),tagInput.val(""),$.fn.abortAjax(ajaxPool),$.fn.clearAutoComplete(inst.autoComplete)}),tagsContainer.on("click",".tag .close",instanceData,function(t){inst=t.data,tag=$(this).parent(".tag"),$.fn.deleteTag(tag,inst)}),tagInput.on("keyup",instanceData,function(t){if(instance=t.data,tagCompleteMain=instance.tagCompleteMain,tagComplete=instance.tagComplete,tagsContainer=instance.tagsContainer,e=tagInput=instance.tagInput,autoComplete=instance.autoComplete,s=instance.options,ajaxPool=instance.ajaxPool,value=$(this).val(),keycode=t.keyCode?t.keyCode:t.which,0==value.length&&$.fn.clearAutoComplete(autoComplete),s.freeEdit&&0==value.length&&keycode==backspaceKey)return lastTagNo=tagsContainer.find(".tag").length,0!=lastTagNo&&(lastTagInfo=$.fn.getTagInfo(tagsContainer,lastTagNo),$.fn.deleteTag(lastTagInfo.selector,instance),1==(s.freeEdit&&s.freeInput)&&tagInput.focus().val(lastTagInfo.text),e);if((keycode==enterKey||t.key==s.tokenizer)&&0<value.length&&1==s.freeInput)return value.endsWith(s.tokenizer)&&(value=value.slice(0,value.lastIndexOf(s.tokenizer))),value=$.trim(value),0==value.length||$.fn.addTag(value,value,instance),$(this).val(""),e;if(autoCompeleteData=s.autocomplete.data,matchedData={},1==s.freeInput&&(matchedData[value]=value),value.length<s.keyLimit)return e;if("object"==typeof s.autocomplete.data){for(i=0;i<autoCompeleteData.length;i++)dataWord=autoCompeleteData[i],-1!=dataWord.indexOf(value)&&(matchedData[dataWord]=dataWord);$.fn.updateAutoComplete(autoComplete,matchedData)}dataUrl=s.autocomplete.ajaxOpts.url,null!=dataUrl&&(ajaxOpts=s.autocomplete.ajaxOpts,params=s.autocomplete.params.call(null,value),ajaxOpts.data=$.extend(s.data,params),ajaxReq=$.ajax(ajaxOpts).done(function(t){if(proccessedData=s.autocomplete.proccessData.call(null,t),0==proccessedData.length)return!1;$.extend(matchedData,proccessedData),$.fn.updateAutoComplete(autoComplete,matchedData)}))})})},$.fn.addTag=function(tagId,tagText,instance){return"object"==typeof CompleteData&&tagId in CompleteData&&(tagText=eval("CompleteData."+tagId)),closeTag="<span class='close'>&times;</span>",tag=$("<li data-id='"+tagId+"' class='tag btn btn-sm btn-outline-info'>"+tagText+closeTag+"</li>"),instance.options.onAdd.call(null,{tagId:tagId,tagText:tagText})&&instance.tagsContainer.append(tag),$.fn.abortAjax(instance.ajaxPool),$.fn.clearAutoComplete(instance.autoComplete),$.fn.refreshUserInput(instance.userInput,instance.tagsContainer,instance.options),!0},$.fn.getTagInfo=function(t,a){return selector=".tag:nth-child("+a+")",tagDom=t.find(selector),tagText=tagDom.text(),tagId=tagDom.data("id"),tagInfo={id:tagId,text:tagText,selector:tagDom},tagInfo},$.fn.updateAutoComplete=function(t,a){var e="";autocompleteCacheData=a,$.each(a,function(t,a){e+="<li data-id='"+t+"'><i class='fa fa-plus'></i> "+a+"</li>"}),t.empty().html(e).removeClass("hide"),t.parent(".tag_complete_main").find(".tag_complete").addClass("has_autocomplete")},$.fn.clearAutoComplete=function(t){t.addClass("hide").empty(),t.parent(".tag_complete_main").find(".tag_complete").removeClass("has_autocomplete")},$.fn.abortAjax=function(t){0<t.length&&$.each(t,function(t,a){a.abort()})},$.fn.refreshUserInput=function(t,a,e){if(tokenizer=e.tokenizer,tokenizedData="",tags=a.find(".tag"),0==tags.length)return!1;$.each(tags,function(t,a){tagData=$(this).data("id")||$(this).text(),tokenizedData+=tagData+","}),tokenizedData=tokenizedData.slice(0,tokenizedData.lastIndexOf(",")),t.val(tokenizedData)},$.fn.deleteTag=function(t,a){var e=$(t).data("id"),n=$(t).text();return t.remove(),a.options.onDelete.call(null,{id:e,text:n}),$.fn.refreshUserInput(a.userInput,a.tagsContainer,a.options),!0}}(jQuery);