!function(m){"use strict";m.fn.ajaxlivesearch=function(c){if(void 0===c.loaded_at)throw"loaded_at must be defined";if(void 0===c.token)throw"token must be defined";var d={url:"core/AjaxProcessor.php",form_anti_bot:"ajaxlivesearch_guard",cache:!1,form_anti_bot_class:"ls_anti_bot",footer_class:"ls_result_footer",next_page_class:"ls_next_page",previous_page_class:"ls_previous_page",page_limit:"page_limit",result_wrapper_class:"ls_result_div",result_class:"ls_result_main",container_class:"ls_container",pagination_class:"pagination",form_class:"search",loaded_at_class:"ls_page_loaded_at",token_class:"ls_token",current_page_hidden_class:"ls_current_page",current_page_lbl_class:"ls_current_page_lbl",last_page_lbl_class:"ls_last_page_lbl",total_page_lbl_class:"ls_last_page_lbl",page_range_class:"ls_items_per_page",page_ranges:[0,5,10],page_range_default:5,navigation_class:"navigation",arrow_class:"arrow",slide_speed:"fast",type_delay:350,max_input:20,min_chars_to_search:0};function u(e,a){e.hide(),a.find("table").addClass("border_radius")}function v(e,a){a.find("table").removeClass("border_radius"),e.show()}function p(e,a,s){if(void 0===e||void 0===s)throw"Form or Options is missing";var t="."+s.current_page_hidden_class;switch(a){case"result":return e.find("."+s.result_wrapper_class);case"footer":return e.find("."+s.footer_class);case"arrow":return e.find("."+s.arrow_class);case"navigation":return e.find("."+s.navigation_class);case"current_page":return e.find(t);case"current_page_lbl":return e.find("."+s.current_page_lbl_class);case"total_page_lbl":return e.find("."+s.total_page_lbl_class);case"page_range":return e.find("."+s.page_range_class);default:throw"Key: "+a+" is not found"}}function h(e,a){e.slideUp(a.slide_speed)}function f(e,a){e.slideDown(a.slide_speed)}function g(s,a,o,e,t){var _=p(a,"result",o);if(m.trim(s.value).length&&m.trim(s.value).length>=o.min_chars_to_search){if(e||s.latest_value!==s.value){if(t){var l=p(a,"current_page",o),r=p(a,"current_page_lbl",o);l.val("1"),r.html("1")}s.selected_row=void 0,s.to_be_executed&&clearTimeout(s.to_be_executed),s.to_be_executed=setTimeout(function(){if(m.trim(s.value).length){m(s).addClass("ajax_loader");var t=p(a,"navigation",o),l=p(a,"total_page_lbl",o),r=p(a,"page_range",o),n=p(a,"footer",o),i=m(a).serializeArray(),e=m(s).data();m.each(e,function(e,a){var s={};s.name=e,s.value=a,i.push(s)}),m.ajax({type:"post",url:d.url,data:i,dataType:"json",cache:d.cache,success:function(e){if("success"===e.status){var a=m.parseJSON(e.result);if(_.find("table tbody").html(a.html),0===a.number_of_results)u(n,_);else{1<a.total_pages?(t.show(),l.html(a.total_pages)):t.hide();var s=function(e){var a,s,t=e.find("option");for(s=0;s<t.length;s+=1)void 0===a&&0!==parseInt(t[s].value)?a=t[s].value:parseInt(t[s].value)<parseInt(a)&&0!==parseInt(t[s].value)&&(a=t[s].value);return a}(r);n.is(":visible")?parseInt(a.number_of_results)<=parseInt(s)?u(n,_):v(n,_):parseInt(a.number_of_results)>parseInt(s)?v(n,_):u(n,_)}}else _.find("table tbody").html(e.message),u(n,_)},error:function(){_.find("table tbody").html("Something went wrong. Please refresh the page."),u(n,_)},complete:function(e){if(m.trim(s.value).length&&_.is(":hidden")&&f(_,o),m(s).removeClass("ajax_loader"),void 0!==o.onAjaxComplete){var a={this:this};o.onAjaxComplete(e,a)}}})}},d.type_delay)}}else(_.is(":visible")||_.is(":animated"))&&h(_,o);s.latest_value=s.value}return d=m.extend(d,c),this.each(function(){var t=m(this),e=t.attr("id");!function(e,a){var s=e.attr("id");e.attr("autocomplete","off"),e.attr("name","ls_query"),e.addClass("ls_query"),e.attr("maxlength",a.max_input);var t,l,r="",n="";for(t=0;t<a.page_ranges.length;t+=1)n=0===(l=a.page_ranges[t])?"All":l,r+='<option value="'+l+'" '+(a.page_range_default===l?"selected":"")+">"+n+"</option>";var i='<div class="'+a.footer_class+'"><div class="col '+a.page_limit+'"><select name="ls_items_per_page" class="'+a.page_range_class+'">'+r+'</select></div><div class="col '+a.navigation_class+'"><i class="icon-left-circle '+a.arrow_class+" "+a.previous_page_class+'"></i></div><div class="col '+a.navigation_class+" "+a.pagination_class+'"><label class="'+a.current_page_lbl_class+'">1</label> / <label class="'+a.last_page_lbl_class+'"></label></div><div class="col '+a.navigation_class+'"><i class="icon-right-circle '+a.arrow_class+" "+a.next_page_class+'"></i></div></div>',o='<div class="'+a.container_class+'"><form accept-charset="UTF-8" class="'+a.form_class+'" id="'+a.form_class+"_"+s+'" name="ls_form"></form></div>',_='<input type="hidden" name="ls_anti_bot" class="'+a.form_anti_bot_class+'" value=""><input type="hidden" name="ls_token" class="'+a.token_class+'" value="'+a.token+'"><input type="hidden" name="ls_page_loaded_at" class="'+a.loaded_at_class+'" value="'+a.loaded_at+'"><input type="hidden" name="ls_current_page" class="'+a.current_page_hidden_class+'" value="1"><input type="hidden" name="ls_query_id" value="'+s+'">',c='<div class="'+a.result_wrapper_class+'"><div class="'+a.result_class+'"><table><tbody></tbody></table></div>'+i+"</div>";e.wrap(o),e.before(_),e.after(c)}(t,d);var s,l=m("#"+d.form_class+"_"+e),r=p(l,"result",d),a=p(l,"arrow",d),n=p(l,"current_page",d),i=p(l,"current_page_lbl",d),o=p(l,"total_page_lbl",d),_=p(l,"page_range",d);t.on("keyup",function(e){var a=e.keyCode||e.which;if(m.trim(t.val()).length&&13===a){if(!r.is(":visible")&&!r.is(":animated")||0===parseInt(r.find("tr").length))f(r,d);else if(void 0!==t.selected_row){var s={selected:m(t.selected_row),this:this,searchField:t};void 0!==c.onResultEnter&&c.onResultEnter(e,s)}}else g(this,l,d,!1,!0)}),t.on("keydown",function(e){var a=e.keyCode||e.which;if(40===a||38===a)return m.trim(t.val()).length&&0!==r.find("tr").length&&(r.is(":visible")||r.is(":animated")?(r.find("tr").removeClass("hover"),void 0===t.selected_row?(t.selected_row=r.find("tr").eq(0),m(t.selected_row).addClass("hover")):(m(t.selected_row).removeClass("hover"),40===a?0===m(t.selected_row).next().length?(t.selected_row=r.find("tr").eq(0),m(t.selected_row).addClass("hover")):(m(t.selected_row).next().addClass("hover"),t.selected_row=m(t.selected_row).next()):0===m(t.selected_row).prev().length?(t.selected_row=r.find("tr").last(),t.selected_row.addClass("hover")):(m(t.selected_row).prev().addClass("hover"),t.selected_row=m(t.selected_row).prev()))):40===a&&f(r,d)),!1}),t.on("focus",function(){m.trim(t.val()).length&&(r.is(":hidden")||r.is(":animated"))&&0!==r.find("tr").length&&(g(this,l,d,!1,!0),f(r,d))}),r.on("mouseover","tr",function(){r.find("tr").removeClass("hover"),t.selected_row=this,m(this).addClass("hover")}),r.on("mouseleave","tr",function(){r.find("tr").removeClass("hover"),t.selected_row=void 0}),l.submit(function(){return!1}),a.on("click",function(){var e;if(m(this).hasClass(d.next_page_class)){if(!(parseInt(n.val(),10)+1<=parseInt(o.html(),10)))return;e=parseInt(n.val(),10)+1}else{if(!(1<=parseInt(n.val(),10)-1))return;e=parseInt(n.val(),10)-1}n.val(e),i.html(e),g(t[0],l,d,!0,!1)}),_.on("change",function(){g(t[0],l,d,!0,!0)}),r.css({left:t.position().left+1,width:t.outerWidth()-2}),m(window).resize(function(){r.css({left:t.position().left+1,width:t.outerWidth()-2})}),m(document).bind("touchstart",function(){s=m(window).scrollTop()}).bind("touchend",function(e){var a;a=s-m(window).scrollTop(),m(document).addClass("touched"),a<10&&-10<a&&(m(e.target).closest(r).length||m(e.target).is(t)||!m(r).is(":visible")||h(r,d))}),m(document).on("click",function(e){m(this).hasClass("touched")?m(this).removeClass("touched"):m(e.target).closest(r).length||m(e.target).is(t)||!m(r).is(":visible")||h(r,d)}),m(r).on("click","tr",function(e){var a={selected:m(t.selected_row),this:this,searchField:t};void 0!==c.onResultClick&&c.onResultClick(e,a)}),m(this).on("ajaxlivesearch:hide_result",function(){h(r,d)}),m(this).on("ajaxlivesearch:search",function(e,a){m(this).val(a.query),g(this,l,d,!0,!0)})}),m("."+d.form_anti_bot_class).val(d.form_anti_bot),this}}(jQuery);